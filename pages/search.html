<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>搜索 - 家逸生活</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="../css/common.css" rel="stylesheet">
    <link href="../css/scrollbar.css" rel="stylesheet">
    <style>
        /* 主题颜色变量 - 与首页保持一致 */
        :root {
            --primary-color: #2A9D8F;
            --secondary-color: #E9C46A;
            --accent-color: #F4A261;
            --dark-color: #264653;
            --light-color: #F8F9FA;
            --bg-color: #F5F7F8;
            
            /* 完整品牌色彩系统 */
            --brand-primary: #2A9D8F;
            --brand-primary-light: #4DB6A9;
            --brand-primary-dark: #1F7A70;
            --brand-primary-transparent: rgba(42, 157, 143, 0.1);
            
            --brand-secondary: #E9C46A;
            --brand-secondary-light: #F2D68B;
            --brand-secondary-dark: #D4A93B;
            
            --brand-accent: #F4A261;
            --brand-accent-light: #F7BE8C;
            --brand-accent-dark: #E68940;
            
            --brand-dark: #264653;
            --brand-dark-light: #3A6A7E;
            --brand-dark-dark: #1A323C;
            
            --brand-light: #F8F9FA;
            --brand-light-dark: #E9ECEF;
            
            --brand-success: #38B2AC;
            --brand-warning: #F59E0B;
            --brand-error: #EF4444;
            --brand-info: #3B82F6;
            
            /* 渐变色 */
            --brand-gradient-primary: linear-gradient(135deg, var(--brand-primary), var(--brand-success));
            --brand-gradient-secondary: linear-gradient(135deg, var(--brand-secondary), var(--brand-accent));
            --brand-gradient-dark: linear-gradient(135deg, var(--brand-dark), #3A6A7E);
            
            /* 阴影 */
            --shadow-sm: 0 2px 4px rgba(38, 70, 83, 0.06);
            --shadow-md: 0 4px 6px rgba(38, 70, 83, 0.1);
            --shadow-lg: 0 10px 15px rgba(38, 70, 83, 0.1);
            --shadow-highlight: 0 5px 15px rgba(42, 157, 143, 0.3);
            
            /* 圆角 */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 18px;
            --radius-full: 9999px;
        }

        /* 搜索框新拟态风格 */
        .search-container {
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
            padding: 0 16px;
            position: relative;
            z-index: 5;
        }
        
        .search-box {
            position: relative;
            display: flex;
            align-items: center;
            background: white;
            border-radius: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            padding: 0 8px 0 40px; /* 为图标留出固定空间 */
            border: 1px solid var(--brand-light-dark);
            transition: all 0.3s ease;
            height: 46px;
        }
        
        .search-box:focus-within {
            box-shadow: 
                inset 4px 4px 8px rgba(163, 177, 198, 0.25),
                inset -4px -4px 8px rgba(255, 255, 255, 0.9),
                0 0 0 3px var(--brand-primary-transparent);
            transform: translateY(-2px);
            border-color: var(--brand-primary-light);
        }
        
        .search-icon {
            color: var(--brand-dark-light);
            font-size: 18px;
            margin-right: 10px;
            transition: color 0.3s ease;
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 2;
        }
        
        .search-box:focus-within .search-icon {
            color: var(--brand-primary);
        }
        
        .search-input {
            flex: 1;
            height: 100%;
            border: none;
            background: transparent;
            font-size: 15px;
            color: var(--brand-dark);
            padding: 0 8px;
            outline: none;
        }
        
        .search-input::placeholder {
            color: #9CA3AF;
            opacity: 0.8;
            font-weight: 400;
            letter-spacing: 0.03em;
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            outline: none;
        }
        
        .search-input:focus::placeholder {
            opacity: 0.5;
            transform: translateX(3px);
        }
        
        .search-actions {
            display: flex;
            gap: 8px;
        }
        
        .voice-search-btn,
        .image-search-btn,
        .search-clear-btn {
            background: transparent;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .voice-search-btn i,
        .image-search-btn i,
        .search-clear-btn i {
            font-size: 18px;
            color: var(--brand-primary);
        }
        
        .voice-search-btn:hover,
        .image-search-btn:hover,
        .search-clear-btn:hover {
            background: var(--brand-primary-transparent);
            transform: translateY(-2px);
        }
        
        .voice-search-btn:active,
        .image-search-btn:active, 
        .search-clear-btn:active {
            transform: translateY(0);
        }

        /* 热门搜索和最近搜索样式 */
        .search-suggestions {
            background: white;
            border-radius: var(--radius-lg);
            padding: 14px;
            box-shadow: var(--shadow-md);
            margin-top: 12px;
            position: relative;
            overflow: hidden;
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border: 1px solid rgba(255, 255, 255, 0.7);
        }

        .search-suggestions::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: var(--brand-gradient-primary);
            border-radius: 2px;
        }
        
        .suggestion-title {
            font-size: 14px;
            color: var(--brand-dark);
            margin-bottom: 10px;
            font-weight: 600;
            padding-left: 10px;
        }
        
        .suggestion-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .tag {
            padding: 5px 12px;
            background: var(--brand-light);
            border-radius: var(--radius-full);
            font-size: 13px;
            color: var(--brand-dark-light);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
            box-shadow: var(--shadow-sm);
        }
        
        .tag:hover {
            background: var(--brand-primary-transparent);
            color: var(--brand-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--brand-primary-light);
        }

        .recent-searches {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .recent-item {
            display: flex;
            align-items: center;
            padding: 6px 10px;
            color: var(--brand-dark-light);
            cursor: pointer;
            border-radius: var(--radius-md);
            transition: all 0.3s ease;
        }
        
        .recent-item i {
            margin-right: 10px;
            font-size: 14px;
            color: var(--brand-primary);
        }
        
        .recent-item:hover {
            color: var(--brand-primary);
            background-color: var(--brand-primary-transparent);
            transform: translateX(5px);
        }

        .clear-history {
            text-align: right;
            margin-top: 10px;
        }

        .clear-history-btn {
            font-size: 13px;
            color: var(--brand-dark-light);
            background: transparent;
            border: none;
            padding: 4px 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .clear-history-btn:hover {
            color: var(--brand-primary);
        }

        /* 搜索结果动效和骨架屏 */
        .skeleton-loader {
            position: relative;
            overflow: hidden;
            background: #f0f0f0;
            border-radius: var(--radius-md);
        }

        .skeleton-loader::after {
            content: "";
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            transform: translateX(-100%);
            background-image: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0) 0,
                rgba(255, 255, 255, 0.3) 50%,
                rgba(255, 255, 255, 0) 100%
            );
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            100% {
                transform: translateX(100%);
            }
        }

        .skeleton-card {
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            background: white;
            margin-bottom: 16px;
        }

        .skeleton-image {
            width: 100%;
            height: 0;
            padding-bottom: 100%;
            background: #f0f0f0;
        }

        .skeleton-content {
            padding: 16px;
        }

        .skeleton-title {
            height: 20px;
            margin-bottom: 12px;
            width: 80%;
        }

        .skeleton-price {
            height: 24px;
            width: 50%;
            margin-bottom: 12px;
        }

        .skeleton-text {
            height: 14px;
            margin-bottom: 8px;
            width: 100%;
        }

        .skeleton-text:last-child {
            width: 60%;
        }

        /* 加载动效 */
        .product-card {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        .products-container.loaded .product-card {
            opacity: 1;
            transform: translateY(0);
        }

        /* 每个卡片延迟显示 */
        .products-container.loaded .product-card:nth-child(1) { transition-delay: 0.05s; }
        .products-container.loaded .product-card:nth-child(2) { transition-delay: 0.1s; }
        .products-container.loaded .product-card:nth-child(3) { transition-delay: 0.15s; }
        .products-container.loaded .product-card:nth-child(4) { transition-delay: 0.2s; }
        .products-container.loaded .product-card:nth-child(5) { transition-delay: 0.25s; }
        .products-container.loaded .product-card:nth-child(6) { transition-delay: 0.3s; }
        .products-container.loaded .product-card:nth-child(7) { transition-delay: 0.35s; }
        .products-container.loaded .product-card:nth-child(8) { transition-delay: 0.4s; }

        /* 无结果状态优化 */
        .no-results {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px 20px;
            margin-top: 20px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .no-results-icon {
            font-size: 64px;
            color: var(--brand-primary-light);
            margin-bottom: 20px;
            opacity: 0.7;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .no-results-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--brand-dark);
            margin-bottom: 8px;
        }

        .no-results-text {
            font-size: 15px;
            color: var(--brand-dark-light);
            margin-bottom: 16px;
            max-width: 300px;
        }

        .spell-correction {
            background-color: var(--brand-primary-transparent);
            padding: 10px 16px;
            border-radius: var(--radius-md);
            margin-bottom: 16px;
            border: 1px dashed var(--brand-primary-light);
        }

        .spell-correction-text {
            font-size: 14px;
            color: var(--brand-dark);
            margin-bottom: 5px;
        }

        .spell-suggestion {
            font-weight: 500;
            color: var(--brand-primary);
            cursor: pointer;
            padding: 2px 8px;
            border-radius: var(--radius-sm);
            transition: all 0.3s ease;
            text-decoration: underline;
            text-underline-offset: 2px;
        }

        .spell-suggestion:hover {
            background-color: var(--brand-primary-light);
            color: white;
            text-decoration: none;
        }

        .alternative-search {
            margin-top: 10px;
            margin-bottom: 20px;
        }

        .alternative-title {
            font-size: 14px;
            color: var(--brand-dark);
            margin-bottom: 10px;
            font-weight: 500;
        }

        .alternative-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }

        /* 商品卡片收藏功能 */
        .favorite-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(-10px);
            border: 1px solid var(--brand-light-dark);
            box-shadow: var(--shadow-sm);
        }

        .favorite-btn i {
            color: var(--brand-dark-light);
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .favorite-btn.active i {
            color: #F87171;
        }

        .favorite-btn.active {
            background: white;
            border-color: #F87171;
        }

        .product-card:hover .favorite-btn {
            opacity: 1;
            transform: translateY(0);
        }

        .favorite-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: var(--shadow-md);
        }

        .favorite-btn:hover i {
            color: #F87171;
        }

        @keyframes heartBeat {
            0% { transform: scale(1); }
            14% { transform: scale(1.3); }
            28% { transform: scale(1); }
            42% { transform: scale(1.3); }
            70% { transform: scale(1); }
        }

        .favorite-btn.active i {
            animation: heartBeat 1s;
        }

        /* 列表视图样式 */
        .list-view .product-card {
            display: flex;
            margin-bottom: 12px;
            background: white;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
        }
        .list-view .product-image {
            width: 120px;
            height: 120px;
            flex-shrink: 0;
            position: relative;
        }
        .list-view .product-info {
            flex: 1;
            padding: 12px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .list-view .product-title {
            font-size: 14px;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .list-view .selling-points {
            margin-bottom: 8px;
            font-size: 12px;
            color: #666;
        }
        .list-view .service-tags {
            margin-top: 8px;
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }
        
        /* 网格视图样式 */
        .grid-view {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            padding: 0 12px;
        }
        
        .grid-view .product-card {
            background: white;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 100%;
            margin-bottom: 0;
            border: 1px solid #f0f0f0;
        }
        
        .grid-view .product-image {
            width: 100%;
            padding-top: 100%;
            position: relative;
            overflow: hidden;
        }
        
        .grid-view .product-image img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .grid-view .product-info {
            padding: 12px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .grid-view .product-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            height: auto;
            min-height: 42px;
            line-height: 1.5;
        }
        
        .grid-view .product-price {
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            font-size: 14px;
        }
        
        .grid-view .current-price {
            font-weight: bold;
            font-size: 16px;
            margin-right: 8px;
        }
        
        .grid-view .original-price {
            color: #999;
            text-decoration: line-through;
            font-size: 12px;
        }
        
        .grid-view .selling-points {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: 1.5;
        }
        
        .grid-view .service-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: auto;
        }
        
        .service-tag {
            font-size: 10px;
            color: #666;
            background: #f5f5f5;
            padding: 2px 5px;
            border-radius: 2px;
            display: inline-flex;
            align-items: center;
            white-space: nowrap;
        }
        
        .service-tag i {
            font-size: 10px;
            margin-right: 2px;
        }
        
        /* 快速预览模态框样式 */
        .quick-view-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .quick-view-content {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalShow 0.3s ease;
        }
        @keyframes modalShow {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .quick-view-close {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--brand-dark);
            border: 1px solid #eee;
        }
        /* 更新分类标签样式 */
        .nav-bar .text-red-500 {
            color: var(--brand-primary);
        }

        .nav-bar .border-red-500 {
            border-color: var(--brand-primary);
        }

        /* 更新价格样式 */
        .current-price {
            color: var(--brand-primary);
        }

        /* 更新筛选按钮样式 */
        .float-filter-btn {
            position: fixed;
            right: 16px;
            bottom: 80px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            z-index: 10;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .float-filter-btn i {
            color: var(--brand-primary);
            font-size: 16px;
        }

        .filter-drawer {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 50; /* 提高z-index */
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            overflow: hidden;
            display: none; /* 初始状态下不显示 */
        }

        .filter-drawer.active {
            visibility: visible;
            opacity: 1;
            display: block;
        }

        #filterPanel {
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 85%;
            max-width: 360px;
            background: white;
            transform: translateX(100%);
            transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex;
            flex-direction: column;
            box-shadow: -2px 0 15px rgba(0, 0, 0, 0.2);
            will-change: transform;
            overflow: hidden;
            height: 100%;
            z-index: 51; /* 比drawer更高 */
        }

        .filter-drawer.active #filterPanel {
            transform: translateX(0);
        }

        /* 筛选头部标题样式 */
        .filter-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            border-bottom: 1px solid #f0f0f0;
        }

        .filter-header h3 {
            font-size: 16px;
            font-weight: 500;
            color: #333;
            margin: 0;
        }

        .filter-header button {
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            cursor: pointer;
        }

        /* 已选条件区域 */
        .selected-filters {
            padding: 12px 16px;
            border-bottom: 1px solid #f0f0f0;
            background: #fafafa;
        }

        .selected-filters-title {
            font-size: 13px;
            font-weight: normal;
            color: #666;
            margin-bottom: 8px;
        }

        .selected-tag {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px 2px 10px;
            background: rgba(42, 157, 143, 0.1);
            color: #2A9D8F;
            border-radius: 4px;
            font-size: 12px;
            margin-right: 6px;
            margin-bottom: 6px;
        }

        .selected-tag button {
            margin-left: 4px;
            width: 14px;
            height: 14px;
            border: none;
            background: transparent;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #2A9D8F;
            font-size: 10px;
            cursor: pointer;
        }

        /* 筛选内容区域 */
        .filter-content {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 70px; /* 为底部按钮留出空间 */
        }

        /* 筛选区域样式 */
        .filter-section {
            padding: 12px 16px;
            border-bottom: 1px solid #f0f0f0;
        }

        .filter-section:last-child {
            border-bottom: none;
        }

        .filter-title {
            font-size: 14px;
            color: #333;
            margin: 0 0 12px 0;
            font-weight: 500;
        }

        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 4px;
        }

        .filter-option {
            position: relative;
            display: inline-block;
            margin-bottom: 8px;
        }

        .filter-option input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }

        .filter-option span {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 4px;
            background-color: #f7f7f7;
            font-size: 13px;
            color: #333;
            transition: all 0.2s;
            cursor: pointer;
        }

        .filter-option input:checked + span {
            background-color: rgba(42, 157, 143, 0.1);
            color: #2A9D8F;
            font-weight: normal;
        }

        /* 自定义尺寸输入框 */
        .custom-size-inputs {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-top: 8px;
            margin-bottom: 8px;
            padding: 0 4px;
        }

        .size-input {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 6px 8px;
            width: 100%;
            font-size: 13px;
            color: #333;
        }

        /* 底部按钮 */
        .filter-actions {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 12px 16px;
            background: white;
            display: flex;
            gap: 12px;
            border-top: 1px solid #f0f0f0;
            z-index: 52;
        }

        .filter-actions button {
            flex: 1;
            height: 40px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: normal;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-reset-btn {
            background: #f5f5f5;
            color: #666;
            border: none;
        }

        .filter-apply-btn {
            background: #2A9D8F;
            color: white;
            border: none;
        }

        .filter-reset-btn:hover {
            background: #ebebeb;
        }

        .filter-apply-btn:hover {
            background: #1F7A70;
        }

        /* 热门筛选样式 */
        .hot-filter-item {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            border-radius: 20px;
            background-color: #f7f7f7;
            font-size: 13px;
            color: #666;
            margin-right: 6px;
            margin-bottom: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .hot-filter-item:hover,
        .hot-filter-item.active {
            background-color: var(--brand-primary-transparent);
            color: var(--brand-primary);
        }

        .hot-filter-item i {
            font-size: 12px;
        }

        /* 添加底部导航样式 */
        .bottom-nav {
            display: flex;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            z-index: 20;
            padding-bottom: env(safe-area-inset-bottom, 0);
            border-top: 1px solid #f0f0f0;
        }

        .bottom-nav .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px 0;
            color: #999;
            text-decoration: none;
            font-size: 12px;
            transition: all 0.3s ease;
            position: relative;
        }

        .bottom-nav .nav-item i {
            font-size: 20px;
            margin-bottom: 2px;
        }

        .bottom-nav .nav-item.active {
            color: var(--brand-primary);
        }

        .bottom-nav .nav-item.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 2px;
            background-color: var(--brand-primary);
            border-radius: 2px;
        }

        .bottom-nav .nav-item:hover {
            color: var(--brand-primary);
        }

        /* Toast容器样式 */
        #toastContainer {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
        }

        .toast-message {
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px 16px;
            border-radius: 20px;
            font-size: 14px;
            margin-bottom: 8px;
            opacity: 0;
            transition: all 0.3s ease;
        }
    </style>
</head>
<body class="bg-white">
    <!-- 搜索框 -->
    <div class="nav-bar bg-white fixed top-0 left-0 right-0 z-10 border-b border-gray-100">
        <div class="flex items-center px-4 h-16 pt-5">
            <a href="home.html" class="text-gray-500 mr-3">
                <i class="fas fa-arrow-left"></i>
            </a>
            <div class="search-box flex-1 mt-3">
                <i class="fas fa-search search-icon"></i>
                <input type="text" 
                       class="search-input" 
                       autocomplete="off"
                       id="searchInput"
                       placeholder="输入关键词搜索沙发">
                <div class="search-actions">
                    <button class="search-clear-btn hidden" id="clearSearchBtn" title="清除">
                        <i class="fas fa-times"></i>
                    </button>
                    <button class="voice-search-btn" title="语音搜索">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button class="image-search-btn" title="图片搜索">
                        <i class="fas fa-camera"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 搜索分类标签，初始状态隐藏 -->
        <div class="flex items-center justify-between px-4 pb-2 mt-2 hidden" id="searchCategoriesBar">
            <div class="flex items-center overflow-x-auto whitespace-nowrap">
                <div class="px-3 py-2 text-sm text-red-500 border-b-2 border-red-500 font-medium">综合</div>
                <div class="px-3 py-2 text-sm text-gray-500">销量</div>
                <div class="px-3 py-2 text-sm text-gray-500">新品</div>
                <div class="px-3 py-2 text-sm text-gray-500">价格</div>
            </div>
            <div class="flex items-center gap-2">
                <button class="view-toggle-btn text-sm px-2 py-1 rounded" id="gridViewBtn" onclick="toggleView('grid')">
                    <i class="fas fa-th-large mr-1"></i>
                </button>
                <button class="view-toggle-btn text-sm px-2 py-1 rounded" id="listViewBtn" onclick="toggleView('list')">
                    <i class="fas fa-list mr-1"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- 主要内容区 -->
    <div class="main-content pt-32 pb-4">
        <!-- 搜索建议 -->
        <div class="search-suggestions mx-4" id="searchSuggestions">
            <div class="suggestion-title">热门搜索</div>
            <div class="suggestion-tags">
                <span class="tag">真皮沙发</span>
                <span class="tag">北欧转角沙发</span>
                <span class="tag">三人布艺沙发</span>
                <span class="tag">现代简约</span>
                <span class="tag">轻奢沙发</span>
                <span class="tag">小户型沙发</span>
                <span class="tag">家逸定制</span>
                <span class="tag">榻榻米</span>
            </div>
            <div class="suggestion-title">最近搜索</div>
            <div class="recent-searches" id="recentSearches">
                <!-- 这里会由JS动态填充 -->
            </div>
            <div class="clear-history">
                <button class="clear-history-btn" id="clearHistoryBtn">
                    <i class="fas fa-trash-alt mr-1"></i>清除搜索历史
                </button>
            </div>
        </div>
        
        <!-- 骨架屏加载效果，默认隐藏 -->
        <div class="skeleton-container px-2 grid grid-cols-2 gap-3 hidden" id="skeletonContainer">
            <!-- 骨架屏卡片1 -->
            <div class="skeleton-card">
                <div class="skeleton-image skeleton-loader"></div>
                <div class="skeleton-content">
                    <div class="skeleton-title skeleton-loader"></div>
                    <div class="skeleton-price skeleton-loader"></div>
                    <div class="skeleton-text skeleton-loader"></div>
                    <div class="skeleton-text skeleton-loader"></div>
                </div>
            </div>
            
            <!-- 骨架屏卡片2 -->
            <div class="skeleton-card">
                <div class="skeleton-image skeleton-loader"></div>
                <div class="skeleton-content">
                    <div class="skeleton-title skeleton-loader"></div>
                    <div class="skeleton-price skeleton-loader"></div>
                    <div class="skeleton-text skeleton-loader"></div>
                    <div class="skeleton-text skeleton-loader"></div>
                </div>
            </div>
            
            <!-- 骨架屏卡片3 -->
            <div class="skeleton-card">
                <div class="skeleton-image skeleton-loader"></div>
                <div class="skeleton-content">
                    <div class="skeleton-title skeleton-loader"></div>
                    <div class="skeleton-price skeleton-loader"></div>
                    <div class="skeleton-text skeleton-loader"></div>
                    <div class="skeleton-text skeleton-loader"></div>
                </div>
            </div>
            
            <!-- 骨架屏卡片4 -->
            <div class="skeleton-card">
                <div class="skeleton-image skeleton-loader"></div>
                <div class="skeleton-content">
                    <div class="skeleton-title skeleton-loader"></div>
                    <div class="skeleton-price skeleton-loader"></div>
                    <div class="skeleton-text skeleton-loader"></div>
                    <div class="skeleton-text skeleton-loader"></div>
                </div>
            </div>
        </div>
        
        <!-- 无结果状态优化 -->
        <div class="no-results" id="noResults">
            <div class="no-results-icon">
                <i class="fas fa-search"></i>
            </div>
            <h3 class="no-results-title">未找到相关结果</h3>
            <p class="no-results-text">抱歉，我们没有找到与"<span id="noResultsKeyword">关键词</span>"相关的商品</p>
            
            <!-- 拼写纠错建议 -->
            <div class="spell-correction" id="spellCorrection">
                <p class="spell-correction-text">您是否要找：</p>
                <span class="spell-suggestion" onclick="correctSearch(this)">北欧真皮沙发</span>
            </div>
            
            <!-- 相关搜索建议 -->
            <div class="alternative-search">
                <p class="alternative-title">您可能感兴趣：</p>
                <div class="alternative-tags">
                    <span class="tag" onclick="performSearch('真皮沙发')">真皮沙发</span>
                    <span class="tag" onclick="performSearch('布艺沙发')">布艺沙发</span>
                    <span class="tag" onclick="performSearch('北欧风格')">北欧风格</span>
                    <span class="tag" onclick="performSearch('家逸定制')">家逸定制</span>
                    <span class="tag" onclick="performSearch('小户型沙发')">小户型沙发</span>
                </div>
            </div>
            
            <div class="suggestions-title">猜您喜欢</div>
            <div class="suggested-products grid grid-cols-2 gap-3 px-2">
                <!-- 推荐产品1 -->
                <div class="product-card">
                    <div class="product-image aspect-square">
                        <img src="https://images.unsplash.com/photo-1505691938895-1758d7feb511?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80" 
                             alt="舒适休闲沙发"
                             loading="lazy">
                        <!-- 添加收藏按钮 -->
                        <button class="favorite-btn" onclick="toggleFavorite(this)" title="收藏">
                            <i class="far fa-heart"></i>
                        </button>
                    </div>
                    <div class="product-info">
                        <h3 class="product-title">舒适休闲沙发</h3>
                        <div class="product-price">
                            <span class="current-price">¥699</span>
                            <span class="original-price">¥899</span>
                        </div>
                        <div class="selling-points">
                            <i class="fas fa-check-circle text-green-500 mr-1"></i>
                            高密度海绵填充，柔软舒适
                        </div>
                    </div>
                </div>
                
                <!-- 推荐产品2 -->
                <div class="product-card">
                    <div class="product-image aspect-square">
                        <img src="https://images.unsplash.com/photo-1555041469-a586c61ea9bc?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80" 
                             alt="北欧风皮质沙发"
                             loading="lazy">
                        <!-- 添加收藏按钮 -->
                        <button class="favorite-btn" onclick="toggleFavorite(this)" title="收藏">
                            <i class="far fa-heart"></i>
                        </button>
                    </div>
                    <div class="product-info">
                        <h3 class="product-title">北欧风格真皮沙发三人座</h3>
                        <div class="product-price">
                            <span class="current-price">¥4,599</span>
                            <span class="original-price">¥5,299</span>
                        </div>
                        <div class="selling-points">
                            <i class="fas fa-check-circle text-green-500 mr-1"></i>
                            高档头层牛皮，质感细腻
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 搜索结果 -->
        <div class="products-container hidden" id="productsContainer">
            <!-- 商品卡片模板 -->
            <div class="product-card">
                <div class="product-image">
                    <img src="https://images.unsplash.com/photo-1540574163026-643ea20ade25?ixlib=rb-1.2.1&auto=format&fit=crop&w=200&q=80" 
                         alt="现代简约灰色沙发" 
                         loading="lazy"
                         class="progressive-img">
                    <!-- 添加收藏按钮 -->
                    <button class="favorite-btn" onclick="toggleFavorite(this)" title="收藏">
                        <i class="far fa-heart"></i>
                    </button>
                </div>
                <div class="product-info">
                    <h3 class="product-title">现代简约风格三人布艺沙发</h3>
                    <div class="product-price">
                        <span class="current-price">¥2,899</span>
                        <span class="original-price">¥3,299</span>
                    </div>
                    <div class="selling-points">
                        <i class="fas fa-check-circle text-green-500 mr-1"></i>
                        高密度海绵填充，柔软舒适
                    </div>
                    <div class="service-tags">
                        <span class="service-tag">
                            <i class="fas fa-truck-fast mr-1"></i>免费配送
                        </span>
                        <span class="service-tag">
                            <i class="fas fa-shield mr-1"></i>正品保障
                        </span>
                        <span class="service-tag">
                            <i class="fas fa-undo mr-1"></i>7天退换
                        </span>
                    </div>
                </div>
            </div>
            
            <!-- 重复其他商品卡片，为每个卡片添加收藏按钮 -->
            <div class="product-card">
                <div class="product-image">
                    <img src="https://images.unsplash.com/photo-1555041469-a586c61ea9bc?ixlib=rb-1.2.1&auto=format&fit=crop&w=200&q=80" 
                         alt="北欧风皮质沙发" 
                         loading="lazy"
                         class="progressive-img">
                    <!-- 添加收藏按钮 -->
                    <button class="favorite-btn" onclick="toggleFavorite(this)" title="收藏">
                        <i class="far fa-heart"></i>
                    </button>
                </div>
                <div class="product-info">
                    <h3 class="product-title">北欧风格真皮沙发三人座</h3>
                    <div class="product-price">
                        <span class="current-price">¥4,599</span>
                        <span class="original-price">¥5,299</span>
                    </div>
                    <div class="selling-points">
                        <i class="fas fa-check-circle text-green-500 mr-1"></i>
                        高密度海绵填充，柔软舒适
                    </div>
                    <div class="service-tags">
                        <span class="service-tag">
                            <i class="fas fa-truck-fast mr-1"></i>免费配送
                        </span>
                        <span class="service-tag">
                            <i class="fas fa-shield mr-1"></i>正品保障
                        </span>
                        <span class="service-tag">
                            <i class="fas fa-undo mr-1"></i>7天退换
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 筛选抽屉 -->
    <div class="filter-drawer fixed inset-0 bg-black bg-opacity-50 z-20 hidden" id="filterDrawer">
        <div class="absolute right-0 top-0 bottom-0 w-4/5 max-w-md bg-white transform transition-transform duration-300 translate-x-full" id="filterPanel">
            <div class="filter-header">
                <h3>筛选条件</h3>
                <button onclick="toggleFilter()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- 已选条件展示区 -->
            <div class="selected-filters">
                <div class="selected-filters-title">已选条件</div>
                <div class="selected-filters-content" id="selectedFiltersContent">
                    <div class="text-gray-400 text-sm">暂无已选条件</div>
                </div>
            </div>
            
            <div class="filter-content">
                <!-- 热门筛选组合 -->
                <div class="filter-section">
                    <div class="filter-title">热门筛选</div>
                    <div class="flex flex-wrap">
                        <div class="hot-filter-item" data-combination="small">
                            <i class="fas fa-home"></i>
                            <span>小户型首选</span>
                        </div>
                        <div class="hot-filter-item" data-combination="value">
                            <i class="fas fa-tags"></i>
                            <span>高性价比</span>
                        </div>
                        <div class="hot-filter-item" data-combination="modern">
                            <i class="fas fa-star"></i>
                            <span>现代简约风</span>
                        </div>
                    </div>
                </div>
                
                <!-- 沙发类型 -->
                <div class="filter-section">
                    <div class="filter-title">沙发类型</div>
                    <div class="filter-options">
                        <label class="filter-option">
                            <input type="checkbox" name="type" value="转角">
                            <span>转角沙发</span>
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" name="type" value="直排">
                            <span>直排沙发</span>
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" name="type" value="单人">
                            <span>单人沙发</span>
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" name="type" value="贵妃">
                            <span>贵妃沙发</span>
                        </label>
                    </div>
                </div>

                <!-- 价格区间 -->
                <div class="filter-section">
                    <div class="filter-title">价格区间</div>
                    <div class="filter-options">
                        <label class="filter-option">
                            <input type="radio" name="price" value="0-2000">
                            <span>2000以下</span>
                        </label>
                        <label class="filter-option">
                            <input type="radio" name="price" value="2000-5000">
                            <span>2000-5000</span>
                        </label>
                        <label class="filter-option">
                            <input type="radio" name="price" value="5000-up">
                            <span>5000以上</span>
                        </label>
                    </div>
                </div>

                <!-- 材质 -->
                <div class="filter-section">
                    <div class="filter-title">材质</div>
                    <div class="filter-options">
                        <label class="filter-option">
                            <input type="checkbox" name="material" value="头层牛皮">
                            <span>头层牛皮</span>
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" name="material" value="布艺">
                            <span>布艺</span>
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" name="material" value="科技布">
                            <span>科技布</span>
                        </label>
                    </div>
                </div>

                <!-- 尺寸 -->
                <div class="filter-section">
                    <div class="filter-title">尺寸</div>
                    <div class="filter-options">
                        <label class="filter-option">
                            <input type="radio" name="size" value="2">
                            <span>2米</span>
                        </label>
                        <label class="filter-option">
                            <input type="radio" name="size" value="2.5">
                            <span>2.5米</span>
                        </label>
                        <label class="filter-option">
                            <input type="radio" name="size" value="3">
                            <span>3米</span>
                        </label>
                        <label class="filter-option">
                            <input type="radio" name="size" value="custom">
                            <span>自定义</span>
                        </label>
                    </div>
                    <!-- 自定义尺寸输入 -->
                    <div class="custom-size-inputs hidden">
                        <input type="number" placeholder="长" class="size-input">
                        <span>×</span>
                        <input type="number" placeholder="宽" class="size-input">
                        <span>cm</span>
                    </div>
                </div>

                <!-- 风格 -->
                <div class="filter-section">
                    <div class="filter-title">风格</div>
                    <div class="filter-options">
                        <label class="filter-option">
                            <input type="checkbox" name="style" value="北欧">
                            <span>北欧</span>
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" name="style" value="现代简约">
                            <span>现代简约</span>
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" name="style" value="中式">
                            <span>中式</span>
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" name="style" value="轻奢">
                            <span>轻奢</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- 底部按钮 -->
            <div class="filter-actions">
                <button class="filter-reset-btn" onclick="resetFilters()">
                    重置
                </button>
                <button class="filter-apply-btn" onclick="applyFilters()">
                    确定
                </button>
            </div>
        </div>
    </div>

    <!-- 浮动筛选按钮 -->
    <div class="float-filter-btn hidden" onclick="toggleFilter()" id="filterBtn">
        <i class="fas fa-filter"></i>
    </div>
    
    <!-- 快速预览模态框 -->
    <div id="toastContainer"></div>

    <!-- 底部导航 -->
    <div class="bottom-nav">
        <a href="home.html" class="nav-item">
            <i class="fas fa-home"></i>
            <span>首页</span>
        </a>
        <a href="category.html" class="nav-item">
            <i class="fas fa-th-large"></i>
            <span>分类</span>
        </a>
        <a href="#" class="nav-item active">
            <i class="fas fa-search"></i>
            <span>搜索</span>
        </a>
        <a href="favorites.html" class="nav-item">
            <i class="far fa-heart"></i>
            <span>收藏</span>
        </a>
        <a href="account.html" class="nav-item">
            <i class="far fa-user"></i>
            <span>我的</span>
        </a>
    </div>
    
    <!-- 搜索相关脚本 -->
    <script>
    // 全局变量，控制页面搜索状态
    let hasPerformedSearch = false;
    let currentView = 'grid'; // 默认视图
    
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('searchInput');
        const searchSuggestions = document.getElementById('searchSuggestions');
        const recentSearches = document.getElementById('recentSearches');
        const voiceSearchBtn = document.querySelector('.voice-search-btn');
        const imageSearchBtn = document.querySelector('.image-search-btn');
        const clearSearchBtn = document.getElementById('clearSearchBtn');
        const clearHistoryBtn = document.getElementById('clearHistoryBtn');
        const productsContainer = document.getElementById('productsContainer');
        const skeletonContainer = document.getElementById('skeletonContainer');
        const noResults = document.getElementById('noResults');
        const noResultsKeyword = document.getElementById('noResultsKeyword');
        const searchCategoriesBar = document.getElementById('searchCategoriesBar');
        const filterBtn = document.getElementById('filterBtn');
        const filterDrawer = document.getElementById('filterDrawer');

        // 初始化页面状态
        function initializePageState() {
            // 强制隐藏不应在初始状态显示的元素
            if (!hasPerformedSearch) {
                hideSearchResultElements();
            }
        }

        // 隐藏搜索结果相关元素
        function hideSearchResultElements() {
            searchCategoriesBar.classList.add('hidden');
            filterBtn.classList.add('hidden');
            filterDrawer.classList.add('hidden');
            filterDrawer.classList.remove('active');
            skeletonContainer.classList.add('hidden');
            productsContainer.classList.add('hidden');
            noResults.classList.add('hidden');
            searchSuggestions.classList.remove('hidden');
        }

        // 显示搜索结果相关元素
        function showSearchResultElements() {
            searchCategoriesBar.classList.remove('hidden');
            filterBtn.classList.remove('hidden');
            searchSuggestions.classList.add('hidden');
        }

        // 加载最近搜索记录
        function loadRecentSearches() {
            const searches = JSON.parse(localStorage.getItem('recentSearches') || '[]');
            if (searches.length > 0) {
                recentSearches.innerHTML = searches
                    .map(search => `
                        <div class="recent-item" data-keyword="${search}">
                            <i class="fas fa-history"></i>
                            <span>${search}</span>
                        </div>
                    `)
                    .join('');
                
                // 添加点击事件
                document.querySelectorAll('.recent-item').forEach(item => {
                    item.addEventListener('click', function() {
                        const keyword = this.dataset.keyword;
                        searchInput.value = keyword;
                        performSearch(keyword);
                    });
                });
            } else {
                recentSearches.innerHTML = '<div class="text-gray-400 text-center py-4">暂无搜索历史</div>';
            }
        }

        // 保存搜索记录
        function saveSearch(keyword) {
            if (!keyword.trim()) return;
            
            let searches = JSON.parse(localStorage.getItem('recentSearches') || '[]');
            searches = [keyword, ...searches.filter(s => s !== keyword)].slice(0, 5);
            localStorage.setItem('recentSearches', JSON.stringify(searches));
            loadRecentSearches();
        }

        // 执行搜索
        function performSearch(keyword) {
            if (!keyword.trim()) return;
            
            // 标记已执行搜索
            hasPerformedSearch = true;
            
            // 保存搜索记录
            saveSearch(keyword);
            
            // 显示搜索结果相关元素
            showSearchResultElements();
            
            // 确保移除loaded类，避免动画问题
            productsContainer.classList.remove('loaded');
            
            // 显示骨架屏，隐藏其他内容
            skeletonContainer.classList.remove('hidden');
            productsContainer.classList.add('hidden');
            noResults.classList.add('hidden');
            
            // 模拟搜索请求延迟
            setTimeout(() => {
                // 隐藏骨架屏
                skeletonContainer.classList.add('hidden');
                
                // 模拟有结果和无结果的情况
                const hasResults = !['无结果测试', '沙发啊', '沙法', '砂发'].includes(keyword);
                
                if (hasResults) {
                    // 显示搜索结果
                    productsContainer.classList.remove('hidden');
                    
                    // 应用当前视图
                    applyCurrentView();
                    
                    // 添加加载动画效果
                    setTimeout(() => {
                        productsContainer.classList.add('loaded');
                        // 加载收藏状态
                        loadFavoriteStatus();
                    }, 100);
                } else {
                    // 显示无结果状态
                    noResults.classList.remove('hidden');
                    noResultsKeyword.textContent = keyword;
                    
                    // 根据关键词设置拼写纠错建议
                    const spellCorrection = document.getElementById('spellCorrection');
                    const spellSuggestion = spellCorrection.querySelector('.spell-suggestion');
                    
                    if (keyword === '沙发啊') {
                        spellSuggestion.textContent = '沙发';
                        spellCorrection.style.display = 'block';
                    } else if (keyword === '沙法') {
                        spellSuggestion.textContent = '沙发';
                        spellCorrection.style.display = 'block';
                    } else if (keyword === '砂发') {
                        spellSuggestion.textContent = '沙发';
                        spellCorrection.style.display = 'block';
                    } else {
                        spellCorrection.style.display = 'none';
                    }
                }
            }, 1000); // 减少加载时间，提高体验
        }

        // 处理搜索输入
        searchInput.addEventListener('input', function() {
            const keyword = this.value.trim();
            
            // 显示/隐藏清除按钮
            if (keyword) {
                clearSearchBtn.classList.remove('hidden');
            } else {
                clearSearchBtn.classList.add('hidden');
                // 如果输入框为空，重置页面状态
                hasPerformedSearch = false;
                hideSearchResultElements();
            }
        });

        // 清除搜索
        clearSearchBtn.addEventListener('click', function() {
            searchInput.value = '';
            this.classList.add('hidden');
            // 重置页面状态
            hasPerformedSearch = false;
            hideSearchResultElements();
        });

        // 清除历史记录
        clearHistoryBtn.addEventListener('click', function() {
            localStorage.removeItem('recentSearches');
            loadRecentSearches();
        });

        // 搜索提交处理
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const keyword = this.value.trim();
                if (keyword) {
                    performSearch(keyword);
                }
            }
        });

        // 点击热门搜索标签
        document.querySelectorAll('.suggestion-tags .tag').forEach(tag => {
            tag.addEventListener('click', function() {
                const keyword = this.textContent;
                searchInput.value = keyword;
                performSearch(keyword);
            });
        });

        // 点击无结果页面中的搜索标签
        document.querySelectorAll('.no-results-search-tags .tag').forEach(tag => {
            tag.addEventListener('click', function() {
                const keyword = this.textContent;
                searchInput.value = keyword;
                performSearch(keyword);
            });
        });

        // 语音搜索
        voiceSearchBtn.addEventListener('click', function() {
            if ('webkitSpeechRecognition' in window) {
                const recognition = new webkitSpeechRecognition();
                recognition.lang = 'zh-CN';
                recognition.continuous = false;
                recognition.interimResults = false;

                recognition.onresult = function(event) {
                    const text = event.results[0][0].transcript;
                    searchInput.value = text;
                    clearSearchBtn.classList.remove('hidden');
                    performSearch(text);
                };

                recognition.start();
                voiceSearchBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                
                recognition.onend = function() {
                    voiceSearchBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                };
            } else {
                alert('您的浏览器不支持语音输入');
            }
        });

        // 图片搜索
        imageSearchBtn.addEventListener('click', function() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    // 这里可以添加图片上传和识别的逻辑
                    console.log('选择了图片:', file.name);
                    // 模拟图片搜索
                    searchInput.value = '图片搜索结果';
                    clearSearchBtn.classList.remove('hidden');
                    performSearch('图片搜索结果');
                }
            };
            input.click();
        });

        // 搜索框获得焦点时的交互
        searchInput.addEventListener('focus', function() {
            // 如果未执行过搜索，确保显示搜索建议
            if (!hasPerformedSearch) {
                searchSuggestions.classList.remove('hidden');
            }
        });

        // 初始化
        loadRecentSearches();
        initializePageState();
        
        // 自动获取焦点
        setTimeout(() => {
            searchInput.focus();
        }, 500);
        
        // URL参数处理
        const urlParams = new URLSearchParams(window.location.search);
        const keywordParam = urlParams.get('keyword');
        if (keywordParam) {
            searchInput.value = keywordParam;
            clearSearchBtn.classList.remove('hidden');
            performSearch(keywordParam);
        } else {
            // 没有关键词参数，确保隐藏不必要的元素
            hasPerformedSearch = false;
            hideSearchResultElements();
        }
        
        // 加载收藏状态
        setTimeout(() => {
            loadFavoriteStatus();
        }, 1000);
        
        // 最后再次检查页面状态，确保正确显示/隐藏元素
        setTimeout(initializePageState, 100);
    });

    // 筛选功能相关脚本
    function toggleFilter() {
        const drawer = document.getElementById('filterDrawer');
        drawer.classList.toggle('hidden');
        drawer.classList.toggle('active');
        
        const panel = document.getElementById('filterPanel');
        
        if (drawer.classList.contains('active')) {
            // 打开抽屉
            // 滚动到顶部
            const content = document.querySelector('.filter-content');
            if (content) {
                content.scrollTop = 0;
            }
        }
        
        console.log('Filter drawer toggled:', drawer.classList.contains('active') ? '开启' : '关闭');
    }

    // 用于更新已选筛选条件的函数
    function updateSelectedFilters() {
        const selectedContainer = document.getElementById('selectedFiltersContent');
        const checkedInputs = document.querySelectorAll('.filter-option input:checked');
        
        if (checkedInputs.length === 0) {
            selectedContainer.innerHTML = '<div class="text-gray-400 text-sm">暂无已选条件</div>';
            return;
        }
        
        let selectedHTML = '';
        checkedInputs.forEach(input => {
            const label = input.nextElementSibling.textContent;
            const filterType = input.name;
            selectedHTML += `
                <span class="selected-tag">
                    ${label}
                    <button onclick="removeFilter('${filterType}', '${input.value}')">
                        <i class="fas fa-times"></i>
                    </button>
                </span>
            `;
        });
        
        selectedContainer.innerHTML = selectedHTML;
    }

    // 移除单个筛选条件
    function removeFilter(type, value) {
        const option = document.querySelector(`.filter-option input[name="${type}"][value="${value}"]`);
        if (option) {
            option.checked = false;
            updateSelectedFilters();
        }
    }

    // 重置所有筛选条件
    function resetFilters() {
        const filterOptions = document.querySelectorAll('.filter-option input');
        filterOptions.forEach(input => {
            input.checked = false;
        });
        
        // 重置自定义尺寸
        const customSizeInputs = document.querySelectorAll('.size-input');
        customSizeInputs.forEach(input => {
            input.value = '';
        });
        
        // 隐藏自定义尺寸输入框
        document.querySelector('.custom-size-inputs').classList.add('hidden');
        
        updateSelectedFilters();
    }

    // 应用筛选条件
    function applyFilters() {
        // 收集选中的筛选条件
        const filters = {
            type: [],
            price: '',
            material: [],
            size: '',
            style: []
        };

        // 获取选中的类型
        document.querySelectorAll('input[name="type"]:checked').forEach(input => {
            filters.type.push(input.value);
        });

        // 获取选中的价格区间
        const selectedPrice = document.querySelector('input[name="price"]:checked');
        if (selectedPrice) {
            filters.price = selectedPrice.value;
        }

        // 获取选中的材质
        document.querySelectorAll('input[name="material"]:checked').forEach(input => {
            filters.material.push(input.value);
        });

        // 获取选中的尺寸
        const selectedSize = document.querySelector('input[name="size"]:checked');
        if (selectedSize) {
            if (selectedSize.value === 'custom') {
                const length = document.querySelector('.size-input[placeholder="长"]').value;
                const width = document.querySelector('.size-input[placeholder="宽"]').value;
                if (length && width) {
                    filters.size = `${length}×${width}`;
                }
            } else {
                filters.size = selectedSize.value;
            }
        }

        // 获取选中的款式
        document.querySelectorAll('input[name="style"]:checked').forEach(input => {
            filters.style.push(input.value);
        });

        // 应用筛选条件并关闭抽屉
        console.log('应用筛选条件:', filters);
        toggleFilter();
        
        // 刷新商品列表
        updateProductList(filters);
    }

    // 监听热门筛选项点击
    document.addEventListener('DOMContentLoaded', function() {
        // 监听筛选选项变化，更新已选条件
        document.querySelectorAll('.filter-option input').forEach(input => {
            input.addEventListener('change', updateSelectedFilters);
        });
        
        // 自定义尺寸输入框显示控制
        const customSizeOption = document.querySelector('input[value="custom"]');
        if (customSizeOption) {
            customSizeOption.addEventListener('change', function() {
                const customInputs = document.querySelector('.custom-size-inputs');
                if (this.checked) {
                    customInputs.classList.remove('hidden');
                } else {
                    customInputs.classList.add('hidden');
                }
            });
        }
        
        // 热门筛选条目点击事件
        document.querySelectorAll('.hot-filter-item').forEach(item => {
            item.addEventListener('click', function() {
                const combination = this.dataset.combination;
                resetFilters();
                
                // 根据组合预设选中对应的选项
                if (combination === 'small') {
                    document.querySelector('input[name="type"][value="单人"]').checked = true;
                    document.querySelector('input[name="price"][value="0-2000"]').checked = true;
                } else if (combination === 'value') {
                    document.querySelector('input[name="price"][value="2000-5000"]').checked = true;
                    document.querySelector('input[name="material"][value="布艺"]').checked = true;
                } else if (combination === 'modern') {
                    document.querySelector('input[name="style"][value="现代简约"]').checked = true;
                }
                
                updateSelectedFilters();
            });
        });
    });

    // 收藏功能
    function toggleFavorite(btn) {
        btn.classList.toggle('active');
        
        // 切换图标
        const icon = btn.querySelector('i');
        if (btn.classList.contains('active')) {
            icon.classList.remove('far');
            icon.classList.add('fas');
            
            // 显示收藏成功提示
            showToast('收藏成功');
            
            // 保存到收藏列表
            const productCard = btn.closest('.product-card');
            const productTitle = productCard.querySelector('.product-title').textContent;
            saveToFavorites(productTitle);
        } else {
            icon.classList.remove('fas');
            icon.classList.add('far');
            
            // 显示取消收藏提示
            showToast('已取消收藏');
            
            // 从收藏列表移除
            const productCard = btn.closest('.product-card');
            const productTitle = productCard.querySelector('.product-title').textContent;
            removeFromFavorites(productTitle);
        }
    }
    
    // 加载收藏状态
    function loadFavoriteStatus() {
        // 从localStorage中获取收藏列表
        const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
        
        // 遍历所有产品卡
        const productCards = document.querySelectorAll('.product-card');
        productCards.forEach(card => {
            const titleElement = card.querySelector('.product-title');
            if (titleElement) {
                const title = titleElement.textContent;
                const favBtn = card.querySelector('.favorite-btn');
                
                // 检查是否已收藏
                if (favorites.includes(title) && favBtn) {
                    favBtn.classList.add('active');
                    const icon = favBtn.querySelector('i');
                    if (icon) {
                        icon.classList.remove('far');
                        icon.classList.add('fas');
                    }
                }
            }
        });
    }
    
    // 保存到收藏列表
    function saveToFavorites(title) {
        const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
        if (!favorites.includes(title)) {
            favorites.push(title);
            localStorage.setItem('favorites', JSON.stringify(favorites));
        }
    }
    
    // 从收藏列表移除
    function removeFromFavorites(title) {
        const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
        const index = favorites.indexOf(title);
        if (index !== -1) {
            favorites.splice(index, 1);
            localStorage.setItem('favorites', JSON.stringify(favorites));
        }
    }
    
    // 创建toast提示
    function showToast(message) {
        // 如果已有toast，先移除
        const existingToast = document.querySelector('.toast-message');
        if (existingToast) {
            existingToast.remove();
        }
        
        // 获取toast容器
        const toastContainer = document.getElementById('toastContainer');
        
        // 创建新toast
        const toast = document.createElement('div');
        toast.className = 'toast-message';
        toast.textContent = message;
        
        // 添加到容器
        toastContainer.appendChild(toast);
        
        // 显示动画
        setTimeout(() => {
            toast.style.opacity = '1';
        }, 10);
        
        // 自动消失
        setTimeout(() => {
            toast.style.opacity = '0';
            setTimeout(() => {
                toast.remove();
            }, 300);
        }, 2000);
    }
    
    // 拼写纠错功能
    function correctSearch(element) {
        const correctedText = element.textContent;
        document.getElementById('searchInput').value = correctedText;
        performSearch(correctedText);
    }
    
    // 视图切换功能
    function toggleView(viewType) {
        currentView = viewType;
        applyCurrentView();
        
        // 更新按钮状态
        const gridViewBtn = document.getElementById('gridViewBtn');
        const listViewBtn = document.getElementById('listViewBtn');
        
        if (viewType === 'grid') {
            gridViewBtn.classList.add('bg-gray-100', 'text-brand-primary');
            listViewBtn.classList.remove('bg-gray-100', 'text-brand-primary');
        } else {
            listViewBtn.classList.add('bg-gray-100', 'text-brand-primary');
            gridViewBtn.classList.remove('bg-gray-100', 'text-brand-primary');
        }
        
        // 保存用户偏好
        localStorage.setItem('preferredView', viewType);
    }
    
    // 应用当前视图
    function applyCurrentView() {
        const productsContainer = document.getElementById('productsContainer');
        
        // 先移除所有视图类
        productsContainer.classList.remove('grid-view', 'list-view');
        
        // 应用当前视图
        productsContainer.classList.add(currentView + '-view');
    }
    
    // 初始化视图设置
    document.addEventListener('DOMContentLoaded', function() {
        // 读取用户偏好的视图设置
        const savedView = localStorage.getItem('preferredView');
        if (savedView) {
            currentView = savedView;
        }
        
        // 设置初始按钮状态
        const gridViewBtn = document.getElementById('gridViewBtn');
        const listViewBtn = document.getElementById('listViewBtn');
        
        if (currentView === 'grid') {
            gridViewBtn.classList.add('bg-gray-100', 'text-brand-primary');
        } else {
            listViewBtn.classList.add('bg-gray-100', 'text-brand-primary');
        }
    });

    // 更新产品列表显示
    function updateProductList(filters) {
        // 这里应该实际发送筛选请求到服务器
        // 但我们在前端模拟这个行为
        console.log('应用筛选条件:', filters);
        
        // 显示骨架屏加载效果
        const skeletonContainer = document.getElementById('skeletonContainer');
        const productsContainer = document.getElementById('productsContainer');
        
        skeletonContainer.classList.remove('hidden');
        productsContainer.classList.add('hidden');
        productsContainer.classList.remove('loaded');
        
        // 模拟加载延迟
        setTimeout(() => {
            skeletonContainer.classList.add('hidden');
            productsContainer.classList.remove('hidden');
            
            // 添加加载动画
            setTimeout(() => {
                productsContainer.classList.add('loaded');
                
                // 提示用户筛选成功
                showToast('筛选条件已应用');
            }, 100);
        }, 800);
    }
    </script>
</body>
</html> 
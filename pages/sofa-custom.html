<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>沙发定制 - 家逸生活</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="../css/common.css" rel="stylesheet">
    <link href="../css/scrollbar.css" rel="stylesheet">
    <link href="../css/sofa-custom.css" rel="stylesheet">
    <link href="../css/sofa-fix-style.css" rel="stylesheet">
    <style>
    /* 优化当前尺寸显示区域 - 一行显示 */
    .current-size-display {
        display: flex;
        align-items: center;
        padding: 10px 15px;
        background: linear-gradient(to right, #f3f8f6, #e9f5f1);
        border-radius: 12px;
        /* margin-bottom: 12px; */
        box-shadow: 0 2px 8px rgba(74, 173, 146, 0.1);
        border: 1px solid rgba(74, 173, 146, 0.15);
        transition: all 0.3s ease;
    }
    
    .current-size-display i {
        color: #4aad92;
        font-size: 1.2rem;
        margin-right: 8px;
        background-color: rgba(74, 173, 146, 0.1);
        padding: 6px;
        border-radius: 50%;
        box-shadow: 0 2px 5px rgba(74, 173, 146, 0.2);
    }
    
    .current-size-display .sofa-name {
        margin-right: 6px;
        position: relative;
        padding-right: 6px;
    }
    
    .current-size-display .sofa-name::after {
        content: '';
        position: absolute;
        top: 50%;
        right: 0;
        transform: translateY(-50%);
        height: 12px;
        width: 1px;
        background-color: rgba(74, 173, 146, 0.3);
    }
    
    .current-size-display #size-dimensions {
        color: #4d5b66;
        font-size: 0.95rem;
    }
    
    /* 适配移动设备 */
    @media (max-width: 480px) {
        .current-size-display {
            padding: 8px 12px;
        }
        
        .current-size-display i {
            font-size: 1rem;
            padding: 5px;
        }
        
        .current-size-display .font-medium {
            font-size: 0.9rem;
        }
    }
    
    /* 保留之前的尺寸标记样式 */
    .sofa-preview-image {
        position: relative;
        min-height: 100px; /* 确保预览区域有足够的高度 */
    }
    
    .dimension-marker {
        position: absolute;
        z-index: 2;
        transition: all 0.3s ease-out; /* 平滑过渡效果 */
    }
    
    .dimension-marker .marker-line {
        position: absolute;
        background-color: rgba(74, 173, 146, 0.6);
    }
    
    .dimension-marker .marker-label {
        position: absolute;
        background-color: rgba(255, 255, 255, 0.9);
        border: 1px solid rgba(74, 173, 146, 0.3);
        padding: 3px 8px;
        border-radius: 4px;
        font-weight: 500;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        white-space: nowrap;
        z-index: 3;
        transition: all 0.3s ease;
    }
    
    /* 步骤4: 配件选择相关样式 */
    .accessory-preview-container {
        background: linear-gradient(to right, #f3f8f6, #e9f5f1);
        border-radius: 12px;
        padding: 12px;
        margin-bottom: 15px;
        box-shadow: 0 2px 8px rgba(74, 173, 146, 0.1);
        border: 1px solid rgba(74, 173, 146, 0.15);
    }
    
    .current-accessory-display {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }
    
    .current-accessory-display i {
        color: #4aad92;
        font-size: 1.2rem;
        margin-right: 8px;
        background-color: rgba(74, 173, 146, 0.1);
        padding: 6px;
        border-radius: 50%;
        box-shadow: 0 2px 5px rgba(74, 173, 146, 0.2);
    }
    
    .accessory-preview-image {
        text-align: center;
        padding: 15px 0;
    }
    
    .accessory-preview-image img {
        max-width: 100%;
        height: auto;
        max-height: 180px;
    }
    
    .accessory-section {
        margin-bottom: 15px;
    }
    
    .config-label {
        font-size: 1rem;
        font-weight: 500;
        margin-bottom: 10px;
        color: #36454f;
        display: flex;
        align-items: center;
    }
    
    /* 修复配件选项网格布局 */
    .accessory-options-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
    }
    
    .accessory-option {
        display: flex;
        align-items: center;
        padding: 12px;
        border: 1px solid #e0e0e0;
        border-radius: 10px;
        background-color: #fff;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-bottom: 2px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }
    
    .accessory-option.active {
        border-color: #4aad92;
        background-color: rgba(74, 173, 146, 0.05);
        box-shadow: 0 2px 10px rgba(74, 173, 146, 0.15);
    }
    
    /* 改进配件选项内部结构样式 */
    .accessory-option-img {
        width: 60px;
        height: 60px;
        border-radius: 8px;
        overflow: hidden;
        margin-right: 10px;
        background-color: #f4f4f4;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0; /* 防止图片被挤压 */
    }
    
    .accessory-option-img img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .accessory-option-img i {
        font-size: 24px;
        color: #888;
    }
    
    .accessory-option.active .accessory-option-img i {
        color: #4aad92;
    }
    
    .accessory-option-info {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-width: 0; /* 防止文本溢出 */
    }
    
    .accessory-option-name {
        font-weight: 500;
        margin-bottom: 4px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .accessory-option-price {
        font-size: 0.9rem;
        color: #4aad92;
    }
    
    /* 价格汇总样式优化 */
    .price-summary {
        background-color: #f7f9fa;
        border-radius: 12px;
        padding: 15px;
        margin-top: 20px;
        margin-bottom: 15px;
        border: 1px solid #e0e0e0;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }
    
    .price-summary-content {
        display: flex;
        flex-direction: column;
    }
    
    .price-detail {
        margin-bottom: 10px;
    }
    
    .price-detail-item {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px dashed #e0e0e0;
    }
    
    .price-detail-item:last-child {
        border-bottom: none;
    }
    
    .price-detail-label {
        color: #555;
        font-weight: 400;
    }
    
    .price-detail-value {
        font-weight: 500;
        color: #333;
    }
    
    .price-total {
        display: flex;
        justify-content: space-between;
        padding-top: 12px;
        border-top: 2px solid #e0e0e0;
        margin-top: 5px;
    }
    
    .price-total-label {
        font-size: 1.1rem;
        font-weight: 600;
        color: #333;
    }
    
    .price-total-value {
        font-size: 1.1rem;
        font-weight: 700;
        color: #4aad92;
    }
    
    /* 改进的响应式布局 */
    @media (max-width: 480px) {
        .accessory-options-grid {
            grid-template-columns: 1fr;
            gap: 10px;
        }
        
        .accessory-option {
            padding: 10px;
        }
        
        .accessory-option-img {
            width: 50px;
            height: 50px;
        }
    }
    
    @media (min-width: 481px) and (max-width: 768px) {
        .accessory-options-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
    }
    
    @media (min-width: 769px) {
        .accessory-options-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
    }
    
    /* 功能图标特殊样式 */
    .function-icon {
        background: linear-gradient(135deg, #f0f7f4, #e6f2ed);
    }
    
    .function-icon i {
        font-size: 28px;
    }
    
    .accessory-option.active .function-icon {
        background: linear-gradient(135deg, #e6f2ed, #d9ebde);
    }
    
    .accessory-option.active .function-icon i {
        color: #4aad92;
        text-shadow: 0 2px 4px rgba(74, 173, 146, 0.2);
    }

    /* 步骤5：确认配置页样式 */
    .confirmation-container {
        display: flex;
        flex-direction: column;
        gap: 16px;
        margin-bottom: 20px;
    }

    @media (min-width: 768px) {
        .confirmation-container {
            flex-direction: row;
        }
    }

    /* 沙发预览区样式 */
    .sofa-confirmation-preview {
        flex: 1;
        background-color: #fff;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        border: 1px solid #eaeaea;
    }

    .preview-header {
        display: flex;
        align-items: center;
        padding: 15px;
        background: linear-gradient(to right, #f3f8f6, #e9f5f1);
        border-bottom: 1px solid rgba(74, 173, 146, 0.15);
    }

    .preview-header i {
        color: #4aad92;
        font-size: 1.2rem;
        margin-right: 10px;
    }

    .preview-header span {
        font-weight: 500;
        color: #36454f;
    }

    .preview-image-container {
        position: relative;
        padding: 20px;
        min-height: 200px;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #fafafa;
    }

    .preview-image-container img {
        max-width: 100%;
        max-height: 180px;
    }

    .sofa-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: rgba(74, 173, 146, 0.9);
        color: white;
        font-size: 0.8rem;
        padding: 3px 8px;
        border-radius: 12px;
        font-weight: 500;
    }

    .dimensions-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        padding: 15px;
        border-top: 1px solid #eaeaea;
        background-color: #f8f8f8;
    }

    .dimension-tag {
        display: inline-flex;
        align-items: center;
        background-color: white;
        padding: 5px 10px;
        border-radius: 6px;
        border: 1px solid #e0e0e0;
        font-size: 0.9rem;
        color: #555;
    }

    .dimension-tag i {
        color: #4aad92;
        margin-right: 5px;
        font-size: 0.85rem;
    }

    /* 配置信息卡片样式 */
    .configuration-summary {
        flex: 1;
        background-color: #fff;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        border: 1px solid #eaeaea;
    }

    .summary-header {
        padding: 15px;
        background: linear-gradient(to right, #f3f8f6, #e9f5f1);
        border-bottom: 1px solid rgba(74, 173, 146, 0.15);
    }

    .summary-title {
        font-weight: 500;
        color: #36454f;
    }

    .summary-content {
        padding: 10px 0;
    }

    .summary-item {
        display: flex;
        align-items: center;
        padding: 10px 15px;
        border-bottom: 1px solid #f0f0f0;
    }

    .summary-item:last-child {
        border-bottom: none;
    }

    .item-label {
        flex: 1;
        display: flex;
        align-items: center;
        color: #555;
    }

    .item-label i {
        color: #4aad92;
        margin-right: 8px;
        font-size: 0.9rem;
    }

    .item-value {
        font-weight: 500;
        color: #333;
        display: flex;
        align-items: center;
    }

    .fabric-sample {
        width: 18px;
        height: 18px;
        border-radius: 50%;
        margin-left: 8px;
        border: 1px solid rgba(0, 0, 0, 0.1);
    }

    /* 价格明细卡片样式 */
    .price-details-card {
        background-color: #fff;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        border: 1px solid #eaeaea;
        margin-bottom: 20px;
    }

    .price-item {
        display: flex;
        justify-content: space-between;
        padding: 15px;
        border-bottom: 1px solid #f0f0f0;
    }

    .price-item.discount {
        background-color: #fff9f9;
    }

    .price-item.discount .price-value {
        color: #ff4d4f;
    }

    .price-label {
        color: #555;
    }

    .price-value {
        font-weight: 500;
        color: #333;
    }

    .price-total {
        display: flex;
        justify-content: space-between;
        padding: 15px;
        background-color: #f8f8f8;
        border-top: 1px solid #eaeaea;
    }

    .total-label {
        font-size: 1.1rem;
        font-weight: 600;
        color: #333;
    }

    .total-value {
        font-size: 1.1rem;
        font-weight: 700;
        color: #4aad92;
    }

    /* 配送信息卡片样式 */
    .delivery-info-card {
        background-color: #fff;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        border: 1px solid #eaeaea;
        padding: 15px;
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    .section-header span {
        font-weight: 500;
        color: #333;
    }

    .edit-btn {
        color: #4aad92;
        font-size: 0.9rem;
        text-decoration: none;
    }

    .default-address {
        background-color: #f9f9f9;
        border-radius: 8px;
        padding: 12px;
        border: 1px dashed #ddd;
    }

    .address-user {
        margin-bottom: 5px;
        font-weight: 500;
    }

    .phone-number {
        color: #666;
        margin-left: 10px;
        font-weight: normal;
    }

    .address-detail {
        color: #555;
        line-height: 1.4;
    }

    .delivery-time-section {
        margin-top: 15px;
    }

    .delivery-options {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .delivery-option {
        display: flex;
        align-items: center;
        cursor: pointer;
    }

    .delivery-option input {
        margin-right: 8px;
    }

    .option-text {
        color: #555;
    }

    /* 下单按钮容器样式 */
    .order-action-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: #fff;
        padding: 15px;
        border-radius: 12px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
        margin-top: 20px;
        margin-bottom: 30px;
    }

    .total-display {
        font-size: 1.1rem;
    }

    .total-label {
        color: #555;
    }

    .total-price {
        font-weight: 700;
        color: #ff4d4f;
        font-size: 1.2rem;
    }

    .place-order-btn {
        background: linear-gradient(to right, #4aad92, #2c9678);
        color: white;
        font-weight: 600;
        padding: 12px 25px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .place-order-btn:hover {
        background: linear-gradient(to right, #3d9c83, #1d8769);
        box-shadow: 0 4px 12px rgba(74, 173, 146, 0.3);
    }
    
    .sofa-categories {
        margin-bottom: 20px;
    }
    
    /* 两行两列网格布局 */
    .sofa-categories-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-template-rows: 1fr 1fr;
        gap: 10px;
    }
    
    /* 沙发分类按钮样式 - 保持原样式 */
    .category-btn {
        background-color: #F3F4F6;
        border: none;
        padding: 15px;
        border-radius: 8px;
        font-weight: 500;
        color: #4B5563;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }
    
    .category-btn i {
        font-size: 14px;
    }
    
    .category-btn:hover {
        background-color: #E5E7EB;
    }
    
    .category-btn.active {
        background-color: #4F46E5;
        color: white;
    }
    
    /* 沙发型号网格和卡片样式 */
    .hot-models-title {
        font-size: 18px;
        font-weight: 600;
        color: #374151;
        margin-top: 20px;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
    }
    
    .hot-models-title i {
        color: #EF4444;
        margin-right: 8px;
        font-size: 20px;
    }
    
    .model-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: 15px;
        margin-top: 15px;
    }
    
    .model-item {
        border-radius: 8px;
        overflow: hidden;
        background-color: #fff;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        cursor: pointer;
        position: relative;
        border: 2px solid transparent;
    }
    
    .model-item:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }
    
    .model-item.selected {
        border-color: #4F46E5;
    }
    
    .model-image-container {
        position: relative;
        overflow: hidden;
        height: 120px;
    }
    
    .model-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }
    
    .model-item:hover .model-image {
        transform: scale(1.05);
    }
    
    .model-hover-info {
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        padding: 8px;
        background: linear-gradient(to top, rgba(0, 0, 0, 0.7), transparent);
        opacity: 0;
        transform: translateY(10px);
        transition: opacity 0.3s ease, transform 0.3s ease;
    }
    
    .model-item:hover .model-hover-info {
        opacity: 1;
        transform: translateY(0);
    }
    
    .model-features {
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
        margin-bottom: 8px;
    }
    
    /* .feature-tag {
        background-color: rgba(255, 255, 255, 0.2);
        color: #fff;
        font-size: 10px;
        padding: 2px 6px;
        border-radius: 100px;
        backdrop-filter: blur(4px);
    } */
    
    .view-details-btn {
        background-color: #4F46E5;
        color: white;
        border: none;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        cursor: pointer;
        transition: background-color 0.3s;
        width: 100%;
    }
    
    .view-details-btn:hover {
        background-color: #4338CA;
    }
    
    .model-stock-badge {
        position: absolute;
        top: 6px;
        right: 6px;
        padding: 2px 6px;
        border-radius: 100px;
        font-size: 10px;
        font-weight: 500;
        color: white;
        z-index: 1;
    }
    
    .model-stock-badge.in-stock {
        background-color: #10B981;
    }
    
    .model-stock-badge.low-stock {
        background-color: #F59E0B;
    }
    
    .model-stock-badge.out-of-stock {
        background-color: #EF4444;
    }
    
    .model-info {
        padding: 8px 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .model-name {
        font-size: 14px;
        font-weight: 500;
        color: #374151;
    }
    
    .model-price {
        font-size: 14px;
        font-weight: 600;
        color: #4F46E5;
    }
    
    /* 移动端适配 */
    @media (max-width: 480px) {
        .sofa-categories-grid {
            gap: 8px;
        }
        
        @media (min-width: 640px) {
            .model-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .model-image-container {
                height: 150px;
            }
        }
    }
    
    /* 功能位位置选择相关样式 */
    .function-position-preview {
        background: #f9f9f9;
        border-radius: 12px;
        padding: 15px;
        margin-bottom: 15px;
        position: relative;
        border: 1px solid #eaeaea;
    }
    
    .sofa-preview-container {
        position: relative;
        margin: 0 auto;
        max-width: 300px;
        height: 150px;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    
    .sofa-preview-img {
        max-width: 100%;
        max-height: 120px;
    }
    
    .function-markers {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        pointer-events: none;
    }
    
    .function-marker {
        position: absolute;
        width: 30px;
        height: 30px;
        background-color: rgba(74, 173, 146, 0.9);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }
    
    .function-marker.left {
        top: 50%;
        left: 15%;
        transform: translateY(-50%);
    }
    
    .function-marker.right {
        top: 50%;
        right: 15%;
        transform: translateY(-50%);
    }
    
    .function-marker.middle {
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }
    
    .function-marker.middle-left {
        top: 50%;
        left: 30%;
        transform: translateY(-50%);
    }
    
    .function-marker.middle-right {
        top: 50%;
        right: 30%;
        transform: translateY(-50%);
    }
    
    .current-position-display {
        margin-top: 15px;
        padding: 10px;
        background-color: white;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px dashed #ddd;
    }
    
    .current-position-display i {
        color: #4aad92;
        margin-right: 8px;
    }
    
    /* 位置选择选项样式 */
    .position-options-grid {
        margin-top: 15px;
    }
    
    .position-options {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 10px;
    }
    
    .position-option {
        display: flex;
        align-items: center;
        padding: 10px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        background-color: white;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .position-option.active {
        border-color: #4aad92;
        background-color: rgba(74, 173, 146, 0.05);
        box-shadow: 0 2px 6px rgba(74, 173, 146, 0.15);
    }
    
    .position-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: #f4f4f4;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 10px;
        flex-shrink: 0;
    }
    
    .position-option.active .position-icon {
        background-color: rgba(74, 173, 146, 0.1);
        color: #4aad92;
    }
    
    .position-info {
        flex: 1;
    }
    
    .position-name {
        font-weight: 500;
        margin-bottom: 2px;
    }
    
    .position-price {
        font-size: 0.9rem;
        color: #4aad92;
    }
    
    /* 移动端适配 */
    @media (max-width: 480px) {
        .position-options {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    /* 添加新的样式 */
    .price-notice {
        display: flex;
        align-items: center;
        margin: 15px;
        padding: 12px;
        background-color: #f8f9fa;
        border-radius: 8px;
        border-left: 3px solid #4aad92;
    }

    .notice-icon {
        color: #4aad92;
        font-size: 20px;
        margin-right: 12px;
    }

    .notice-text {
        color: #555;
        font-size: 14px;
        line-height: 1.4;
    }

    .contact-info-form {
        background-color: #fff;
        border-radius: 12px;
        padding: 15px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        border: 1px solid #eaeaea;
    }

    .form-group label {
        display: block;
        margin-bottom: 5px;
        color: #333;
        font-weight: 500;
    }

    .order-note {
        color: #666;
        font-size: 14px;
        display: flex;
        align-items: center;
    }

    .order-note i {
        color: #4aad92;
        margin-right: 8px;
    }

    .configuration-summary {
        background-color: #fff;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        border: 1px solid #eaeaea;
        margin-bottom: 20px;
    }

    /* 添加底部提交按钮样式 */
    .btn-submit {
        background: linear-gradient(to right, #4aad92, #2c9678);
        color: white;
        font-weight: 600;
        padding: 0 25px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        flex: 2;
        transition: all 0.3s ease;
    }

    .btn-submit:hover {
        background: linear-gradient(to right, #3d9c83, #1d8769);
        box-shadow: 0 4px 12px rgba(74, 173, 146, 0.3);
    }

    .order-note-container {
        padding: 15px;
        background-color: #f9f9f9;
        border-radius: 12px;
        border: 1px solid #eaeaea;
    }
    </style>
</head>
<body>
    <!-- 顶部导航栏 -->
    <div class="nav-bar fixed top-0 left-0 right-0 z-10">
        <div class="flex items-center px-4 h-full">
            <a href="javascript:history.back()" class="text-gray-500">
                <i class="fas fa-arrow-left text-lg"></i>
            </a>
        <!-- 切换按钮组 -->
            <div class="tab-group flex-1 mx-4">
            <button class="tab-btn active" data-tab="standard">标准定制</button>
            <button class="tab-btn" data-tab="ai">智能定制</button>
            </div>
            <a href="sofa-scenes.html" class="text-gray-600 flex items-center mr-2">
                <i class="fas fa-tags text-sm"></i>
                <span class="ml-1 text-xs">场景</span>
            </a>
            <div class="w-5"></div><!-- 占位元素，平衡布局 -->
        </div>
        </div>

    <!-- 主要内容区 -->
    <div class="main-content pb-32 px-4">
        <!-- 步骤指示器 -->
        <div class="steps-indicator">
            <div class="step active" data-step="1">
                <div class="step-circle">1</div>
                <div class="step-label">选择型号</div>
            </div>
            <div class="step" data-step="2">
                <div class="step-circle">2</div>
                <div class="step-label">选择面料</div>
            </div>
            <div class="step" data-step="3">
                <div class="step-circle">3</div>
                <div class="step-label">选择尺寸</div>
            </div>
            <div class="step" data-step="4">
                <div class="step-circle">4</div>
                <div class="step-label">选择配件</div>
            </div>
            <div class="step" data-step="5">
                <div class="step-circle">5</div>
                <div class="step-label">确认配置</div>
            </div>
        </div>

        <!-- 翻转容器 -->
        <div class="flip-container">
            <div class="flipper">
                <!-- 标准定制内容 -->
                <div class="standard-custom">
                    <!-- 步骤1: 型号选择 -->
                    <div class="step-content active" data-step="1">
                        <div class="custom-section">
                            <div class="section-title">
                                <i class="fas fa-couch"></i>型号选择
                            </div>
                            
                            <!-- 沙发分类按钮 -->
                            <div class="sofa-categories">
                                <div class="sofa-categories-grid">
                                    <button class="category-btn" data-category="XK"><i class="fas fa-couch"></i>功能沙发</button>
                                    <button class="category-btn" data-category="L"><i class="fas fa-bed"></i>拉床沙发</button>
                                    <button class="category-btn" data-category="HM"><i class="fas fa-compress-alt"></i>智能沙发</button>
                                    <button class="category-btn" data-category="JY"><i class="fas fa-tachometer-alt"></i>压缩沙发</button>
                                </div>
                            </div>
                            
                            <!-- 热门款式标题 -->
                            <div class="hot-models-title" id="models-title">
                                <i class="fas fa-fire"></i> 热门推荐
                            </div>
                            
                            <!-- 沙发型号网格 -->
                            <div class="model-grid">
                                <!-- 沙发型号将动态生成 -->
                            </div>
                            
                            <!-- 沙发型号模板 -->
                            <template id="model-template">
                                <div class="model-item">
                                    <div class="model-image-container">
                                        <img src="" alt="" class="model-image">
                                        <div class="model-hover-info">
                                            <div class="model-features">
                                                <!-- 功能标签会被动态添加 -->
                                            </div>
                                            <button class="view-details-btn">查看详情</button>
                                        </div>
                                        <div class="model-stock-badge"></div>
                                    </div>
                                    <div class="model-info">
                                        <div class="model-name font-medium"></div>
                                        <div class="model-price"></div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>

                    <!-- 步骤2: 面料选择 -->
                    <div class="step-content" data-step="2">
                        <div class="custom-section" style="margin-top: 10px;">
                            <div class="section-title">
                                <i class="fas fa-palette"></i>面料选择
                            </div>
                            
                            <!-- 快速搜索和编码输入 -->
                            <div class="fabric-search mb-4">
                                <div class="relative">
                                    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                    <input type="text" class="w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg" placeholder="输入面料编码，如TC-001-BLUE">
                                    <!-- <button class="absolute right-2 top-1/2 transform -translate-y-1/2 text-primary">
                                        <i class="fas fa-barcode"></i>
                                    </button> -->
                                </div>
                            </div>
                            
                            <!-- 面料分类选择 -->
                            <div class="fabric-categories mb-4">
                                <div class="flex overflow-x-auto pb-2 hide-scrollbar">
                               
                                    <button class="category-chip">真皮</button>
                                    <button class="category-chip">科技布</button>
            
                                </div>
                            </div>
                            
                            <!-- 面料卡片网格 -->
                            <div class="fabric-grid">
                                <!-- 面料卡片1 -->
                                <div class="fabric-card">
                                    <div class="fabric-img-container">
                                 
                                        <div class="fabric-carousel">
                                            <div class="carousel-inner">
                                                <img src="https://images.unsplash.com/photo-1615529162924-f8605388461d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80" alt="灰色麻质" class="fabric-img active">
                                                <img src="https://images.unsplash.com/photo-1493663284031-b7e3aefcae8e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80" alt="灰色麻质沙发" class="fabric-img">
                                            </div>
                                            <div class="carousel-nav">
                                                <span class="carousel-dot active" data-index="0"></span>
                                                <span class="carousel-dot" data-index="1"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="fabric-info">
                                        <div class="fabric-header">
                                            <div class="fabric-model">立特8967</div>
                                            <div class="fabric-price">15元/尺</div>
                                        </div>
                                        <div class="fabric-features">
                                            <span class="feature-tag premium">头层牛皮</span>
                                            <span class="feature-tag">耐磨</span>
                                            <span class="feature-tag">防水</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 面料卡片2 -->
                                <div class="fabric-card">
                                    <div class="fabric-img-container">
                                    
                                        <div class="fabric-carousel">
                                            <div class="carousel-inner">
                                                <img src="https://images.unsplash.com/photo-1620222053918-6edb898f0e51?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80" alt="米白色绒布" class="fabric-img active">
                                                <img src="https://images.unsplash.com/photo-1560448204-603b3fc33ddc?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80" alt="米白色绒布沙发" class="fabric-img">
                                            </div>
                                            <div class="carousel-nav">
                                                <span class="carousel-dot active" data-index="0"></span>
                                                <span class="carousel-dot" data-index="1"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="fabric-info">
                                        <div class="fabric-header">
                                            <div class="fabric-model">绒典7512</div>
                                            <div class="fabric-price">22元/尺</div>
                                        </div>
                                        <div class="fabric-features">
                                            <span class="feature-tag premium">高级绒面</span>
                                            <span class="feature-tag">柔软</span>
                                            <span class="feature-tag">可拆洗</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 面料卡片3 -->
                                <div class="fabric-card">
                                    <div class="fabric-img-container">
                                 
                                        <div class="fabric-carousel">
                                            <div class="carousel-inner">
                                                <img src="https://images.unsplash.com/photo-1620222052419-d131a14fc06e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80" alt="深蓝色皮质" class="fabric-img active">
                                                <img src="https://images.unsplash.com/photo-1583847268964-b28dc8f51f92?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80" alt="深蓝色皮质沙发" class="fabric-img">
                                            </div>
                                            <div class="carousel-nav">
                                                <span class="carousel-dot active" data-index="0"></span>
                                                <span class="carousel-dot" data-index="1"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="fabric-info">
                                        <div class="fabric-header">
                                            <div class="fabric-model">海格3305</div>
                                            <div class="fabric-price">32元/尺</div>
                                        </div>
                                        <div class="fabric-features">
                                            <span class="feature-tag premium">头层牛皮</span>
                                            <span class="feature-tag">高档</span>
                                            <span class="feature-tag">耐用</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 面料卡片4 -->
                                <div class="fabric-card">
                                    <div class="fabric-img-container">
                                   
                                        <div class="fabric-carousel">
                                            <div class="carousel-inner">
                                                <img src="https://images.unsplash.com/photo-1631280340909-a7b5bc3c3d7c?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80" alt="浅绿色麻布" class="fabric-img active">
                                                <img src="https://images.unsplash.com/photo-1616486338812-3dadae4b4ace?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80" alt="浅绿色麻布沙发" class="fabric-img">
                                            </div>
                                            <div class="carousel-nav">
                                                <span class="carousel-dot active" data-index="0"></span>
                                                <span class="carousel-dot" data-index="1"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="fabric-info">
                                        <div class="fabric-header">
                                            <div class="fabric-model">生态6281</div>
                                            <div class="fabric-price">18元/尺</div>
                                        </div>
                                        <div class="fabric-features">
                                            <span class="feature-tag premium">亚麻面料</span>
                                            <span class="feature-tag">环保</span>
                                            <span class="feature-tag">透气</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 面料预览与色卡 -->
                        <div class="custom-section mt-4" style="display: none;">
                            <!-- 隐藏原来的预览区域，但保留结构以避免JS错误 -->
                            <div class="preview-container" style="display: none;">
                                <div class="preview-window">
                                    <img src="https://images.unsplash.com/photo-1493663284031-b7e3aefcae8e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=800&q=80" alt="沙发预览" class="preview-img">
                                </div>
                                
                                <div class="color-palette" style="display: none;">
                                    <div class="color-swatches">
                                        <div class="color-swatch active" data-color="gray" style="background-color: #b0b0b0;" title="TC-001-GRAY">
                                            <i class="fas fa-check"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 步骤3: 规格选择 -->
                    <div class="step-content" data-step="3">
                        <!-- <div class="custom-section">
                            <div class="section-title">
                                <i class="fas fa-couch"></i>选择尺寸
                            </div>
                        </div> -->

                        <!-- 紧凑型沙发预览区域 -->
                        <div class="compact-preview-container" style="margin-top: 5px;">
                            <div class="current-size-display">
                                <i class="fas fa-couch"></i>
                                <span class="font-medium sofa-name" style="width: 60px;">三人位沙发</span>
                                <span id="size-dimensions" class="font-medium">（180 × 90 × 45 cm）</span>
                            </div>
                            
                            <div class="sofa-preview-image">
                                <img src="../img/sofa-types/triple-seats.svg" alt="沙发预览图" id="sofaTypeImage">
                                
                                <div class="dimension-marker width-marker">
                                    <!-- <div class="marker-line"></div> -->
                                    <div class="marker-label"><span>L: </span><span id="vizLength">180</span> cm</div>
                                </div>
                                
                                <div class="dimension-marker depth-marker">
                                    <!-- <div class="marker-line"></div> -->
                                    <div class="marker-label"><span>W: </span><span id="vizDepth">90</span> cm</div>
                                </div>
                                
                                <div class="dimension-marker height-marker">
                                    <!-- <div class="marker-line"></div> -->
                                    <div class="marker-label"><span>H: </span><span id="vizHeight">45</span> cm</div>
                                </div>
                            </div>
                        </div>
                                
                        <!-- 沙发尺寸选择 -->
                        <div class="config-label">沙发尺寸选择</div>
                        <div class="sofa-type-cards">
                            <div class="sofa-type-card" data-type="single" data-size="180" data-name="单人位">
                                <div class="sofa-card-icon">
                                    <i class="fas fa-couch"></i>
                                    <span class="seat-count">1</span>
                                </div>
                                <div class="sofa-card-info">
                                    <div class="sofa-card-title">单人位</div>
                                    <div class="sofa-card-size">长度: 90cm</div>
                                </div>
                                <div class="sofa-card-scene">适合小户型/书房</div>
                            </div>
                            <div class="sofa-type-card active" data-type="double" data-size="210" data-name="二人位">
                                <div class="sofa-card-icon">
                                    <i class="fas fa-couch"></i>
                                    <span class="seat-count">2</span>
                                </div>
                                <div class="sofa-card-info">
                                    <div class="sofa-card-title">二人位</div>
                                    <div class="sofa-card-size">长度: 180cm</div>
                                </div>
                                <div class="sofa-card-scene">适合15-20㎡客厅</div>
                            </div>
                            <div class="sofa-type-card" data-type="triple" data-size="240" data-name="三人位">
                                <div class="sofa-card-icon">
                                    <i class="fas fa-couch"></i>
                                    <span class="seat-count">3</span>
                                </div>
                                <div class="sofa-card-info">
                                    <div class="sofa-card-title">三人位</div>
                                    <div class="sofa-card-size">长度: 210cm</div>
                                </div>
                                <div class="sofa-card-scene">适合20-25㎡客厅</div>
                            </div>
                            <div class="sofa-type-card" data-type="quad" data-size="270" data-name="四人位">
                                <div class="sofa-card-icon">
                                    <i class="fas fa-couch"></i>
                                    <span class="seat-count">4</span>
                                </div>
                                <div class="sofa-card-info">
                                    <div class="sofa-card-title">四人位</div>
                                    <div class="sofa-card-size">长度: 240cm</div>
                                </div>
                                <div class="sofa-card-scene">适合25㎡以上客厅</div>
                            </div>
                            <div class="sofa-type-card" data-type="triple-left" data-size="300" data-name="3+左妃">
                                <div class="sofa-card-icon">
                                    <i class="fas fa-couch"></i>
                                    <span class="seat-count">3+</span>
                                </div>
                                <div class="sofa-card-info">
                                    <div class="sofa-card-title">3+左妃</div>
                                    <div class="sofa-card-size">长度: 270cm</div>
                                </div>
                                <div class="sofa-card-scene">适合L型空间</div>
                            </div>
                            <div class="sofa-type-card" data-type="triple-right" data-size="330" data-name="3+右妃">
                                <div class="sofa-card-icon">
                                    <i class="fas fa-couch"></i>
                                    <span class="seat-count">3+</span>
                                </div>
                                <div class="sofa-card-info">
                                    <div class="sofa-card-title">3+右妃</div>
                                    <div class="sofa-card-size">长度: 270cm</div>
                                </div>
                                <div class="sofa-card-scene">适合L型空间</div>
                            </div>
                        </div>
                            
                        <!-- 简化的尺寸调整区域 -->
                        <div class="dimensions-fold-container mt-4">
                            <div class="adjust-link-container">
                                <a href="javascript:void(0)" id="dimensions-fold-btn" class="dimensions-fold-btn" style="margin-top: 5px;">
                                    <span class="fold-btn-content">
                                        <i class="fas fa-sliders-h"></i>
                                        <span>点击调整具体尺寸</span>
                                    </span>
                                    <i class="fas fa-chevron-down fold-icon"></i>
                                </a>
                            </div>
                            
                            <div id="dimensions-content" class="dimensions-content">
                                <!-- 沙发主要尺寸调整 -->
                                <div class="dimension-row">
                                    <div class="dimension-label-container">
                                        <div class="config-label">总长度</div>
                                        <div class="dimension-controls">
                                            <button class="dimension-btn minus" data-dimension="length">
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            <div class="current-value"><span id="length-value">180</span> 厘米</div>
                                            <button class="dimension-btn plus" data-dimension="length">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="dimension-tip">标准双人位沙发长度为180厘米</div>
                                </div>
                                
                                <!-- 座深调整 -->
                                <div class="dimension-row">
                                    <div class="dimension-label-container">
                                        <div class="config-label">座位深度</div>
                                        <div class="dimension-controls">
                                            <button class="dimension-btn minus" data-dimension="depth">
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            <div class="current-value"><span id="depth-value">90</span> 厘米</div>
                                            <button class="dimension-btn plus" data-dimension="depth">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="dimension-tip">较深的座位更适合休闲和躺卧</div>
                                </div>
                                
                                <!-- 座高调整 -->
                                <div class="dimension-row">
                                    <div class="dimension-label-container">
                                        <div class="config-label">座位高度</div>
                                        <div class="dimension-controls">
                                            <button class="dimension-btn minus" data-dimension="height">
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            <div class="current-value"><span id="height-value">45</span> 厘米</div>
                                            <button class="dimension-btn plus" data-dimension="height">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="dimension-tip">标准高度适合大多数人</div>
                                </div>
                                
                                <!-- 恢复默认值按钮 -->
                                <div class="reset-dimension-container">
                                    <button class="reset-dimension-btn">
                                        <i class="fas fa-undo"></i> 恢复默认尺寸
                                    </button>
                                </div>
                            </div>
                        </div>
                                
                        <!-- 适用场景推荐 -->
                        <div class="scene-recommendation mt-4">
                            <div class="recommendation-card">
                                <div class="recommendation-icon">
                                    <i class="fas fa-lightbulb"></i>
                                </div>
                                <div class="recommendation-content">
                                    <div class="recommendation-title">空间搭配建议</div>
                                    <div class="recommendation-text" id="spaceRecommendation">
                                        二人位沙发适合15-20㎡的客厅空间，建议搭配一个茶几和一个小边几，保持通道宽度至少70cm。
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 步骤4: 配件选择 -->
                    <div class="step-content" data-step="4">
                        <div class="custom-section">
                            <div class="section-title">
                                <i class="fas fa-puzzle-piece"></i>配件选择
                            </div>
                            
                            <!-- 茶几选择 -->
                            <div class="accessory-section">
                                <div class="config-label">茶几选择</div>
                                <!-- 添加茶几位置说明提示 -->
                                <div class="tip-container" style="background: linear-gradient(to right, #f0f7f4, #e6f2ed); border-left: 4px solid #4aad92; padding: 8px 10px; margin-bottom: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                    <div style="display: flex; align-items: center;">
                                        <div style="margin-right: 10px; background-color: rgba(74, 173, 146, 0.15); width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                            <i class="fas fa-info-circle" style="color: #4aad92; font-size: 16px;"></i>
                                        </div>
                                        <div style="flex: 1;">
                                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                                <!-- <span style="color: #2a6b5c; font-weight: 600; font-size: 14px;">茶几位置提示</span> -->
                                                <span style="color: #666; font-size: 0.85rem;">
                                                    <!-- <i class="fas fa-phone" style="color: #4aad92; margin-right: 3px;"></i>
                                                    <a href="tel:400-888-9999" style="color: #4aad92; text-decoration: none; font-weight: 500;">联系客服</a> -->
                                                </span>
                                            </div>
                                            <div style="display: flex; align-items: center; margin-top: 4px;">
                                                <strong style="color: #333; font-size: 13px;">茶几默认在中间位或中左位</strong>
                                                <span style="color: #666; font-size: 12px; margin-left: 8px; border-left: 1px dashed rgba(74, 173, 146, 0.3); padding-left: 8px;">如需特殊茶几布局，请在备注中详细说明或联系客服</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="accessory-options-grid">
                                    <div class="accessory-option active" data-accessory="no-table" data-price="0" data-name="无">
                                        <div class="accessory-option-img">
                                            <i class="fas fa-ban"></i>
                                        </div>
                                        <div class="accessory-option-info">
                                            <div class="accessory-option-name">无</div>
                                            <div class="accessory-option-price">免费</div>
                                        </div>
                                    </div>
                                    <div class="accessory-option" data-accessory="ash" data-price="150" data-name="水曲柳">
                                        <div class="accessory-option-img">
                                            <img src="https://images.unsplash.com/photo-1554295405-abb8fd54f153?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80" alt="水曲柳茶几">
                                        </div>
                                        <div class="accessory-option-info">
                                            <div class="accessory-option-name">水曲柳</div>
                                            <div class="accessory-option-price">+¥150</div>
                                        </div>
                                    </div>
                                    <div class="accessory-option" data-accessory="white-marble" data-price="150" data-name="白理石">
                                        <div class="accessory-option-img">
                                            <img src="https://images.unsplash.com/photo-1533090481720-856c6e3c1fdc?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80" alt="白理石茶几">
                                        </div>
                                        <div class="accessory-option-info">
                                            <div class="accessory-option-name">白理石</div>
                                            <div class="accessory-option-price">+¥150</div>
                                        </div>
                                    </div>
                                    <div class="accessory-option" data-accessory="black-walnut" data-price="150" data-name="黑胡桃">
                                        <div class="accessory-option-img">
                                            <img src="https://images.unsplash.com/photo-1596162954151-cdcb4c0f70a8?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80" alt="黑胡桃茶几">
                                        </div>
                                        <div class="accessory-option-info">
                                            <div class="accessory-option-name">黑胡桃</div>
                                            <div class="accessory-option-price">+¥150</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 功能位选择 -->
                            <div class="accessory-section mt-5">
                                <div class="config-label">功能位选择</div>
                                <div class="accessory-options-grid">
                                    <div class="accessory-option active" data-accessory="no-function" data-price="0" data-name="无" data-show-position="false">
                                        <div class="accessory-option-img function-icon">
                                            <i class="fas fa-ban"></i>
                                        </div>
                                        <div class="accessory-option-info">
                                            <div class="accessory-option-name">无</div>
                                            <div class="accessory-option-price">免费</div>
                                        </div>
                                    </div>
                                    <div class="accessory-option" data-accessory="one-touch" data-price="150" data-name="一键启动" data-show-position="true">
                                        <div class="accessory-option-img function-icon">
                                            <i class="fas fa-power-off"></i>
                                        </div>
                                        <div class="accessory-option-info">
                                            <div class="accessory-option-name">一键启动</div>
                                            <div class="accessory-option-price">+¥150</div>
                                        </div>
                                    </div>
                                    <div class="accessory-option" data-accessory="button-control" data-price="150" data-name="按键启动" data-show-position="true">
                                        <div class="accessory-option-img function-icon">
                                            <i class="fas fa-sliders-h"></i>
                                        </div>
                                        <div class="accessory-option-info">
                                            <div class="accessory-option-name">按键启动</div>
                                            <div class="accessory-option-price">+¥150</div>
                                        </div>
                                    </div>
                                    <div class="accessory-option" data-accessory="manual" data-price="80" data-name="手动" data-show-position="true">
                                        <div class="accessory-option-img function-icon">
                                            <i class="fas fa-hand-paper"></i>
                                        </div>
                                        <div class="accessory-option-info">
                                            <div class="accessory-option-name">手动</div>
                                            <div class="accessory-option-price">+¥80</div>
                                        </div>
                                    </div>
                                </div>
                                <!-- 功能位警告信息 -->
                                <div id="function-warning" class="mt-2 text-sm text-red-500" style="display: none;"></div>
                            </div>
                            
                            <!-- 功能位位置选择（仅对多人位沙发显示） -->
                            <div class="accessory-section mt-5" id="function-position-section" style="display: none;">
                                <!-- <div class="config-label">功能位位置选择</div> -->
                                
                                <!-- 添加功能位位置说明提示 -->
                                <div class="tip-container" style="background: linear-gradient(to right, #f0f7f4, #e6f2ed); border-left: 4px solid #4aad92; padding: 8px 10px; margin-bottom: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                    <div style="display: flex; align-items: center;">
                                        <div style="margin-right: 10px; background-color: rgba(74, 173, 146, 0.15); width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                            <i class="fas fa-info-circle" style="color: #4aad92; font-size: 16px;"></i>
                                        </div>
                                        <div style="flex: 1;">
                                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                
                                                <span style="color: #666; font-size: 0.85rem;">
                                            
                                                </span>
                                            </div>
                                            <div style="display: flex; align-items: center; margin-top: 4px;">
                                                <strong style="color: #333; font-size: 13px;">功能位默认设置在边位</strong>
                                                <span style="color: #666; font-size: 12px; margin-left: 8px; border-left: 1px dashed rgba(74, 173, 146, 0.3); padding-left: 8px;">如需特殊功能布局，请在备注中详细说明或联系客服</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 功能位位置预览 - 优化视觉效果 -->
                                <div class="function-position-preview mb-4" style="background: linear-gradient(to right, #f0f7f4, #e6f2ed);">
                                    <div class="sofa-preview-container">
                                        <img src="../img/sofa-types/double-seats.svg" alt="沙发预览" id="functionPositionPreview" class="sofa-preview-img">
                                        <div class="function-markers">
                                            <div class="function-marker left" id="leftFunctionMarker" style="display: none; background-color: rgba(74, 173, 146, 0.9); box-shadow: 0 0 10px rgba(74, 173, 146, 0.5);">
                                                <i class="fas fa-power-off"></i>
                                            </div>
                                            <div class="function-marker right" id="rightFunctionMarker" style="display: none; background-color: rgba(74, 173, 146, 0.9); box-shadow: 0 0 10px rgba(74, 173, 146, 0.5);">
                                                <i class="fas fa-power-off"></i>
                                            </div>
                                            <div class="function-marker middle" id="middleFunctionMarker" style="display: none; background-color: rgba(74, 173, 146, 0.9); box-shadow: 0 0 10px rgba(74, 173, 146, 0.5);">
                                                <i class="fas fa-power-off"></i>
                                            </div>
                                            <div class="function-marker middle-left" id="middleLeftFunctionMarker" style="display: none; background-color: rgba(74, 173, 146, 0.9); box-shadow: 0 0 10px rgba(74, 173, 146, 0.5);">
                                                <i class="fas fa-power-off"></i>
                                            </div>
                                            <div class="function-marker middle-right" id="middleRightFunctionMarker" style="display: none; background-color: rgba(74, 173, 146, 0.9); box-shadow: 0 0 10px rgba(74, 173, 146, 0.5);">
                                                <i class="fas fa-power-off"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="current-position-display" style="background: white; border: 1px solid rgba(74, 173, 146, 0.3); margin-top: 15px;">
                                        <i class="fas fa-map-marker-alt"></i>
                                        <span id="currentFunctionPosition">尚未选择位置</span>
                                    </div>
                                </div>
                                
                                <!-- 位置选择选项 - 改进布局和视觉效果 -->
                                <div class="config-label">选择功能位位置</div>
                                <div class="position-options-grid">
                                    <!-- 双人位位置选项 -->
                                    <div class="position-options double-seat-options" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px;">
                                        <div class="position-option active" data-position="none" data-price="0" style="border-radius: 8px; transition: all 0.3s ease;">
                                            <div class="position-icon" style="background-color: #f4f4f4; padding: 8px;">
                                                <i class="fas fa-ban"></i>
                                            </div>
                                            <div class="position-info">
                                                <div class="position-name">无</div>
                                                <div class="position-price">免费</div>
                                            </div>
                                        </div>
                                        <div class="position-option" data-position="left" data-price="0" style="border-radius: 8px; transition: all 0.3s ease;">
                                            <div class="position-icon" style="background-color: #f4f4f4; padding: 8px;">
                                                <i class="fas fa-arrow-left"></i>
                                            </div>
                                            <div class="position-info">
                                                <div class="position-name">左侧</div>
                                                <div class="position-price">+¥0</div>
                                            </div>
                                        </div>
                                        <div class="position-option" data-position="right" data-price="0" style="border-radius: 8px; transition: all 0.3s ease;">
                                            <div class="position-icon" style="background-color: #f4f4f4; padding: 8px;">
                                                <i class="fas fa-arrow-right"></i>
                                            </div>
                                            <div class="position-info">
                                                <div class="position-name">右侧</div>
                                                <div class="position-price">+¥0</div>
                                            </div>
                                        </div>
                                        <div class="position-option" data-position="both" data-price="150" style="border-radius: 8px; transition: all 0.3s ease;">
                                            <div class="position-icon" style="background-color: #f4f4f4; padding: 8px;">
                                                <i class="fas fa-arrows-alt-h"></i>
                                            </div>
                                            <div class="position-info">
                                                <div class="position-name">两侧</div>
                                                <div class="position-price">+¥150</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 三人位位置选项 -->
                                    <div class="position-options triple-seat-options" style="display: none; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px;">
                                        <div class="position-option active" data-position="none" data-price="0" style="border-radius: 8px; transition: all 0.3s ease;">
                                            <div class="position-icon" style="background-color: #f4f4f4; padding: 8px;">
                                                <i class="fas fa-ban"></i>
                                            </div>
                                            <div class="position-info">
                                                <div class="position-name">无</div>
                                                <div class="position-price">免费</div>
                                            </div>
                                        </div>
                                        <div class="position-option" data-position="left" data-price="0" style="border-radius: 8px; transition: all 0.3s ease;">
                                            <div class="position-icon" style="background-color: #f4f4f4; padding: 8px;">
                                                <i class="fas fa-arrow-left"></i>
                                            </div>
                                            <div class="position-info">
                                                <div class="position-name">左侧</div>
                                                <div class="position-price">+¥0</div>
                                            </div>
                                        </div>
                                        <div class="position-option" data-position="middle" data-price="0" style="border-radius: 8px; transition: all 0.3s ease;">
                                            <div class="position-icon" style="background-color: #f4f4f4; padding: 8px;">
                                                <i class="fas fa-arrows-alt"></i>
                                            </div>
                                            <div class="position-info">
                                                <div class="position-name">中间</div>
                                                <div class="position-price">+¥0</div>
                                            </div>
                                        </div>
                                        <div class="position-option" data-position="right" data-price="0" style="border-radius: 8px; transition: all 0.3s ease;">
                                            <div class="position-icon" style="background-color: #f4f4f4; padding: 8px;">
                                                <i class="fas fa-arrow-right"></i>
                                            </div>
                                            <div class="position-info">
                                                <div class="position-name">右侧</div>
                                                <div class="position-price">+¥0</div>
                                            </div>
                                        </div>
                                        <div class="position-option" data-position="left-right" data-price="150" style="border-radius: 8px; transition: all 0.3s ease;">
                                            <div class="position-icon" style="background-color: #f4f4f4; padding: 8px;">
                                                <i class="fas fa-arrows-alt-h"></i>
                                            </div>
                                            <div class="position-info">
                                                <div class="position-name">两侧</div>
                                                <div class="position-price">+¥150</div>
                                            </div>
                                        </div>
                                        <div class="position-option" data-position="all" data-price="300" style="border-radius: 8px; transition: all 0.3s ease;">
                                            <div class="position-icon" style="background-color: #f4f4f4; padding: 8px;">
                                                <i class="fas fa-th"></i>
                                            </div>
                                            <div class="position-info">
                                                <div class="position-name">全部</div>
                                                <div class="position-price">+¥300</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 四人位位置选项 -->
                                    <div class="position-options quad-seat-options" style="display: none; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px;">
                                        <div class="position-option active" data-position="none" data-price="0" style="border-radius: 8px; transition: all 0.3s ease;">
                                            <div class="position-icon" style="background-color: #f4f4f4; padding: 8px;">
                                                <i class="fas fa-ban"></i>
                                            </div>
                                            <div class="position-info">
                                                <div class="position-name">无</div>
                                                <div class="position-price">免费</div>
                                            </div>
                                        </div>
                                        <div class="position-option" data-position="left" data-price="0" style="border-radius: 8px; transition: all 0.3s ease;">
                                            <div class="position-icon" style="background-color: #f4f4f4; padding: 8px;">
                                                <i class="fas fa-arrow-left"></i>
                                            </div>
                                            <div class="position-info">
                                                <div class="position-name">左侧</div>
                                                <div class="position-price">+¥0</div>
                                            </div>
                                        </div>
                                        <div class="position-option" data-position="middle-left" data-price="0" style="border-radius: 8px; transition: all 0.3s ease;">
                                            <div class="position-icon" style="background-color: #f4f4f4; padding: 8px;">
                                                <i class="fas fa-angle-double-left"></i>
                                            </div>
                                            <div class="position-info">
                                                <div class="position-name">中左</div>
                                                <div class="position-price">+¥0</div>
                                            </div>
                                        </div>
                                        <div class="position-option" data-position="middle-right" data-price="0" style="border-radius: 8px; transition: all 0.3s ease;">
                                            <div class="position-icon" style="background-color: #f4f4f4; padding: 8px;">
                                                <i class="fas fa-angle-double-right"></i>
                                            </div>
                                            <div class="position-info">
                                                <div class="position-name">中右</div>
                                                <div class="position-price">+¥0</div>
                                            </div>
                                        </div>
                                        <div class="position-option" data-position="right" data-price="0" style="border-radius: 8px; transition: all 0.3s ease;">
                                            <div class="position-icon" style="background-color: #f4f4f4; padding: 8px;">
                                                <i class="fas fa-arrow-right"></i>
                                            </div>
                                            <div class="position-info">
                                                <div class="position-name">右侧</div>
                                                <div class="position-price">+¥0</div>
                                            </div>
                                        </div>
                                        <div class="position-option" data-position="edges" data-price="150" style="border-radius: 8px; transition: all 0.3s ease;">
                                            <div class="position-icon" style="background-color: #f4f4f4; padding: 8px;">
                                                <i class="fas fa-arrows-alt-h"></i>
                                            </div>
                                            <div class="position-info">
                                                <div class="position-name">两端</div>
                                                <div class="position-price">+¥150</div>
                                            </div>
                                        </div>
                                        <div class="position-option" data-position="all" data-price="450" style="border-radius: 8px; transition: all 0.3s ease;">
                                            <div class="position-icon" style="background-color: #f4f4f4; padding: 8px;">
                                                <i class="fas fa-th"></i>
                                            </div>
                                            <div class="position-info">
                                                <div class="position-name">全部</div>
                                                <div class="position-price">+¥450</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 添加客服联系备注提示 -->
                                <div class="contact-service-note mt-4" style="background-color: #fff9f0; border-radius: 8px; padding: 12px; margin-top: 15px; border: 1px dashed #ffc107;">
                                    <div style="display: flex; align-items: center;">
                                        <i class="fas fa-exclamation-circle" style="color: #ff9800; margin-right: 10px; font-size: 18px;"></i>
                                        <div>
                                            <p style="margin: 0; color: #333; font-weight: 500;">需要更详细的功能布局定制?</p>
                                            <p style="margin: 5px 0 0; color: #666; font-size: 0.9rem;">请在最后的备注中详细说明，或联系客服 <a href="tel:400-888-9999" style="color: #4aad92; text-decoration: none;">400-888-9999</a> 获取专属方案</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 步骤5: 确认配置 -->
                    <div class="step-content" data-step="5">
                        <!-- 配置摘要 -->
                        <div class="custom-section" style="padding-bottom: 0;">
                            <div class="section-title">
                                <i class="fas fa-check-circle"></i>确认您的沙发配置
                            </div>
                            
                            <!-- 配置信息卡片 -->
                            <div class="configuration-summary" style="width: 100%">
                                <div class="summary-header">
                                    <div class="summary-title">配置详情</div>
                                </div>
                                <div class="summary-content">
                                    <div class="summary-item">
                                        <div class="item-label"><i class="fas fa-tag"></i> 型号</div>
                                        <div class="item-value" id="confirm-model-name">现代简约沙发</div>
                                    </div>
                                    <div class="summary-item">
                                        <div class="item-label"><i class="fas fa-couch"></i> 沙发类型</div>
                                        <div class="item-value" id="confirm-sofa-type-text">二人位沙发</div>
                                    </div>
                                    <div class="summary-item">
                                        <div class="item-label"><i class="fas fa-ruler-combined"></i> 尺寸规格</div>
                                        <div class="item-value" id="confirm-dimensions">180 × 90 × 45 cm</div>
                                    </div>
                                    <div class="summary-item">
                                        <div class="item-label"><i class="fas fa-palette"></i> 面料材质</div>
                                        <div class="item-value" id="confirm-fabric">
                                            <span id="confirm-fabric-name">灰色麻质</span>
                                            <div class="fabric-sample" id="confirm-fabric-color" style="background-color: #b0b0b0;"></div>
                                        </div>
                                    </div>
                                    <div class="summary-item">
                                        <div class="item-label"><i class="fas fa-coffee"></i> 茶几选择</div>
                                        <div class="item-value" id="confirm-table">无</div>
                                    </div>
                                    <div class="summary-item">
                                        <div class="item-label"><i class="fas fa-cogs"></i> 功能配置</div>
                                        <div class="item-value" id="confirm-function">无</div>
                                    </div>
                                </div>
                                
                                <!-- 价格说明提示 -->
                                <!-- <div class="price-notice">
                                    <div class="notice-icon"><i class="fas fa-info-circle"></i></div>
                                    <div class="notice-text">我们将根据您的具体配置需求，由客服人员为您提供详细的价格方案。</div>
                                </div> -->
                            </div>
                        </div>
                        
                        <!-- 备注信息 - 修改样式使其与配置详情一致 -->
                        <!-- <div class="custom-section" style="padding-bottom: 0; margin-top: -5px;"> -->
                            <!-- <div class="section-title">
                                <i class="fas fa-comment-alt"></i>备注信息
                            </div> -->
                            <!-- 添加configuration-summary样式类，使其与配置详情相同 -->
                            <div class="configuration-summary" style="width: 100%; margin-bottom: 10px;">
                                <div class="summary-header" style="padding: 12px 15px;">
                                    <div class="summary-title">备注内容</div>
                                </div>
                                <div class="summary-content" style="padding: 0;">
                                    <textarea class="form-input" rows="3" placeholder="请输入其他要求或建议，例如：交付时间、安装需求等" id="order-remarks" style="width: 100%; border: none; padding: 15px; resize: none; background-color: transparent; min-height: 80px;"></textarea>
                                </div>
                            </div>
                        <!-- </div> -->
                        
                        <!-- 价格说明提示 - 独立区域 -->
                        <div class="custom-section" style="padding-top: 0; margin-top: -5px;">
                            <div class="order-note-container">
                                <div class="order-note">
                                    <i class="fas fa-info-circle"></i>
                                    <span>提交后，我们的客服将尽快与您联系确认详情及价格</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 智能定制内容 -->
                <div class="ai-custom">
                    <div class="custom-section">
                        <div class="section-title">
                            <i class="fas fa-magic"></i>智能定制
                        </div>
                        <div class="upload-zone mb-4">
                            <i class="fas fa-cloud-upload-alt text-3xl text-primary mb-2"></i>
                            <div class="text-lg font-medium">上传参考图片</div>
                            <div class="text-sm text-gray-500 mt-2">
                                支持拖拽或粘贴图片
                            </div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <textarea
                                class="w-full p-3 rounded-lg border border-gray-200"
                                rows="4"
                                placeholder="描述您想要的沙发风格、材质和功能，例如：我想要一款简约现代风格、灰色麻质面料、带储物功能的沙发"
                            ></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 底部导航 -->
        <div class="bottom-nav">
            <button class="nav-btn btn-prev" id="prevStep">上一步</button>
            <button class="nav-btn btn-next" id="nextStep">下一步</button>
            <!-- 修改提交定制需求按钮，确保初始是隐藏的，并使用display: block而非inline-block -->
            <button class="nav-btn btn-submit" id="submitOrder" style="display: none;">提交定制需求</button>
        </div>
    </div>

    <!-- 沙发选择模态框 -->
    <div class="sofa-modal" id="sofaModal">
        <div class="modal-header">
            <div class="search-box">
                <i class="fas fa-search search-icon"></i>
                <input type="text" id="sofaSearch" placeholder="搜索沙发型号" class="search-input">
                <button id="clearSearch" class="clear-search"><i class="fas fa-times"></i></button>
            </div>
            <button class="close-modal">&times;</button>
        </div>
        
        <div class="modal-body" >
            <div class="sofa-list" id="sofaList">
                <!-- 示例沙发项目结构 -->
                <div class="sofa-item">
                    <div class="sofa-img-container">
                        <img src="https://images.unsplash.com/photo-1555041469-a586c61ea9bc?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80" alt="现代简约沙发" class="sofa-img">
                    </div>
                    <div class="sofa-details">
                        <div class="sofa-info">
                            <div class="sofa-name">CS-101 现代简约沙发</div>
                            <div class="sofa-price">¥<span class="price-value">2,999</span> <span class="price-unit">起</span></div>
                        </div>
                        <div class="sofa-scenario">
                            <i class="fas fa-home"></i> 适用：小户型客厅、书房
                        </div>
                        <div class="sofa-features">
                            <div class="feature-tag"><i class="fas fa-tint-slash"></i>可拆洗</div>
                            <div class="feature-tag"><i class="fas fa-box"></i>带收纳</div>
                            <div class="feature-tag"><i class="fas fa-sync-alt"></i>可调节</div>
                            <div class="feature-tag"><i class="fas fa-bed"></i>沙发床</div>
                        </div>
                    </div>
                </div>
                
                <!-- 动态生成的沙发项会添加到这里 -->
                </div>
        </div>
    </div>
    
    <!-- 模态框背景遮罩 -->
    <div class="modal-overlay" id="modalOverlay"></div>

    <!-- 面料预览模态框 -->
    <div class="fabric-modal" id="fabricModal">
        <div class="modal-header">
            <div class="modal-title">面料预览</div>
            <button class="close-modal">&times;</button>
        </div>
        
        <div class="modal-body">
            <!-- 面料预览 -->
            <div class="preview-container" style="margin-top: 0;">
                <div class="preview-window">
                    <img src="" alt="面料预览" class="preview-img" id="modalPreviewImg">
                </div>
                
                <!-- 色卡工具条 -->
                <div class="color-palette mt-3">
                    <div class="color-title">可选颜色</div>
                    <div class="color-swatches" id="modalColorSwatches">
                        <div class="color-swatch active" data-color="gray" style="background-color: #b0b0b0;">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="color-swatch" data-color="beige" style="background-color: #e8dcc1;"></div>
                        <div class="color-swatch" data-color="blue" style="background-color: #143b70;"></div>
                        <div class="color-swatch" data-color="green" style="background-color: #7cb082;"></div>
                        <div class="color-swatch" data-color="brown" style="background-color: #75523c;"></div>
                        <div class="color-swatch" data-color="red" style="background-color: #a93e3e;"></div>
                        <div class="color-swatch" data-color="black" style="background-color: #323232;"></div>
                    </div>
                </div>
                
                <!-- 面料详情 -->
                <div class="fabric-details mt-3">
                    <div class="detail-cards">
                        <div class="detail-card">
                            <div class="detail-card-title">
                                <i class="fas fa-tag"></i> 基本信息
                            </div>
                            <div class="detail-card-content">
                                <div class="detail-row">
                                    <span class="detail-label">型号:</span>
                                    <span class="detail-value truncate-text" id="fabricModel">立特8967</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">类别:</span>
                                    <span class="detail-value truncate-text" id="fabricCategory">头层牛皮</span>
                                </div>
                                <div class="detail-row highlight-row">
                                    <span class="detail-label">价格:</span>
                                    <span class="detail-value price-value" id="fabricPrice">15元/尺</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="detail-card">
                            <div class="detail-card-title">
                                <i class="fas fa-info-circle"></i> 材质详情
                            </div>
                            <div class="detail-card-content">
                                <div class="detail-row">
                                    <span class="detail-label">材质:</span>
                                    <span class="detail-value truncate-text" id="fabricMaterial">黄牛皮</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">颜色:</span>
                                    <span class="detail-value truncate-text" id="fabricColor">灰色</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">特性:</span>
                                    <div class="detail-tags" id="fabricFeatures">
                                        <span class="detail-tag">耐磨</span>
                                        <span class="detail-tag">防水</span>
                                    </div>
                                </div>
                                <div class="detail-row expandable">
                                    <span class="detail-label">描述:</span>
                                    <span class="detail-value truncate-text">选用高品质黄牛皮，经过特殊工艺处理，柔软舒适，透气性强，使用寿命长。</span>
                                    <span class="expandable-indicator"><i class="fas fa-plus"></i></span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="detail-card">
                            <div class="detail-card-title">
                                <i class="fas fa-home"></i> 适用场景
                            </div>
                            <div class="detail-card-content">
                                <div class="detail-row mb-2">
                                    <span class="detail-label">推荐:</span>
                                    <span class="detail-value truncate-text">家庭客厅、儿童房、宠物家庭</span>
                                </div>
                                <div class="scene-tags" id="fabricScenes">
                                    <div class="scene-tag">
                                        <i class="fas fa-couch"></i>
                                        <span>客厅沙发</span>
                                    </div>
                                    <div class="scene-tag">
                                        <i class="fas fa-child"></i>
                                        <span>儿童房家具</span>
                                    </div>
                                    <div class="scene-tag">
                                        <i class="fas fa-paw"></i>
                                        <span>宠物友好型</span>
                                    </div>
                                </div>
                                <div class="detail-row mt-3 expandable">
                                    <span class="detail-value-full truncate-text">适合追求高品质生活的家庭，特别适用于有孩子和宠物的家庭，耐脏耐磨，清洁方便。也适合小户型和开放式客厅。</span>
                                    <span class="expandable-indicator"><i class="fas fa-plus"></i></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 按钮组固定在底部 -->
        <div class="modal-footer">
            <button class="send-sample-btn">
                <i class="fas fa-paper-plane"></i> 寄送皮样
            </button>
            <button class="add-to-custom-btn">
                <i class="fas fa-check-circle"></i> 选择此面料
            </button>
        </div>
    </div>
    
    <!-- 模态框背景遮罩 -->
    <div class="modal-overlay" id="fabricModalOverlay"></div>

    <!-- 寄送皮样表单模态窗口 -->
    <div id="sampleFormModal" class="sample-form-modal">
        <div class="modal-header">
            <h3 class="modal-title">申请面料样品</h3>
            <button id="closeSampleForm" class="close-modal"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
            <!-- 样品信息改为横向卡片样式 -->
            <div class="sample-card mb-4">
                <div class="sample-image">
                    <img id="sampleImage" src="" alt="面料样品">
                </div>
                <div class="sample-details">
                    <h4 class="sample-title">样品信息</h4>
                    <p id="sampleDetail" class="sample-model">立特8967 (灰色)</p>
                    <div class="sample-features">
                        <span class="sample-feature">高级面料</span>
                        <span class="sample-feature">耐磨</span>
                        <span class="sample-feature">防水</span>
                    </div>
                </div>
            </div>
            
            <!-- 地址管理部分 -->
            <div class="address-management mb-4">
                <!-- <h4 class="text-lg font-medium mb-2">收货地址</h4> -->
                
                <!-- 地址选择器 -->
                <div class="address-selector mb-3">
                    <button id="showAddressList" class="address-list-btn"><i class="fas fa-address-book mr-1"></i> 选择地址</button>
                    <button id="showAddressForm" class="address-form-btn ml-2"><i class="fas fa-pen mr-1"></i> 手动填写</button>
                </div>
                
                <!-- 地址列表弹出层 -->
                <div id="addressListDropdown" class="address-list-dropdown hidden">
                    <div class="address-list-header">
                        <h4>选择收货地址</h4>
                        <button id="closeAddressList" class="close-dropdown"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="address-list-body">
                        <!-- 地址项 -->
                        <div class="address-item" data-id="1">
                            <div class="address-item-content">
                                <div class="recipient-info">
                                    <span class="name">张三</span>
                                    <span class="phone">138****1234</span>
                                    <span class="default-tag">默认</span>
                                </div>
                                <div class="address-text">北京市朝阳区某某路123号某某小区A座3单元501室</div>
                            </div>
                            <div class="address-select-btn">选择</div>
                        </div>
                        
                        <div class="address-item" data-id="2">
                            <div class="address-item-content">
                                <div class="recipient-info">
                                    <span class="name">张三</span>
                                    <span class="phone">139****5678</span>
                                </div>
                                <div class="address-text">上海市浦东新区陆家嘴世纪大道1号环球金融中心88层</div>
                            </div>
                            <div class="address-select-btn">选择</div>
                        </div>
                        
                        <div class="address-item" data-id="3">
                            <div class="address-item-content">
                                <div class="recipient-info">
                                    <span class="name">李四</span>
                                    <span class="phone">137****9876</span>
                                </div>
                                <div class="address-text">广州市天河区天河路385号太古汇商场4楼</div>
                            </div>
                            <div class="address-select-btn">选择</div>
                        </div>
                        
                        <!-- 没有地址时显示 -->
                        <div id="noAddressMessage" class="no-address-message hidden">
                            <div class="empty-icon"><i class="fas fa-map-marker-alt"></i></div>
                            <div class="empty-text">您还没有保存的地址</div>
                            <button id="emptyFormBtn" class="empty-form-btn">手动填写</button>
                        </div>
                    </div>
                </div>
                
                <!-- 已选择的地址卡片 -->
                <div id="selectedAddressCard" class="selected-address-card mb-3">
                    <div class="address-card-content">
                        <div class="recipient-info">
                            <span id="selectedName" class="name">张三</span>
                            <span id="selectedPhone" class="phone">138****1234</span>
                            <span id="defaultTag" class="default-tag">默认</span>
                        </div>
                        <div id="selectedAddress" class="address-text">北京市朝阳区某某路123号某某小区A座3单元501室</div>
                    </div>
                    <button id="changeAddressBtn" class="change-address-btn">
                        <i class="fas fa-exchange-alt"></i> 更换
                    </button>
                </div>
                
                <!-- 已选择地址时的备注和提交按钮 -->
                <div id="selectedAddressActions" class="mb-4">
                    <div class="form-group mb-3">
                        <label for="selectedAddressRemark" class="form-label">备注信息（选填）</label>
                        <textarea id="selectedAddressRemark" class="form-input h-20" placeholder="如有特殊要求，请在此说明"></textarea>
                    </div>
                    <div class="address-form-actions">
                        <button id="submitSelectedAddress" class="submit-sample-btn-inline w-full"><i class="fas fa-paper-plane mr-1"></i> 提交申请</button>
                    </div>
                </div>
            </div>
            
            <!-- 地址表单 -->
            <div id="addressForm" class="hidden">
                <div class="form-group mb-3">
                    <label for="recipientName" class="form-label">收件人姓名 <span class="required-mark">*</span></label>
                    <input type="text" id="recipientName" class="form-input" placeholder="请输入收件人姓名">
                </div>
                <div class="form-group mb-3">
                    <label for="recipientPhone" class="form-label">联系电话 <span class="required-mark">*</span></label>
                    <input type="tel" id="recipientPhone" class="form-input" placeholder="请输入联系电话">
                </div>
                <div class="form-group mb-3">
                    <label for="addressDetail" class="form-label">详细地址 <span class="required-mark">*</span></label>
                    <textarea id="addressDetail" class="form-input h-20" placeholder="请输入详细地址"></textarea>
                </div>
                
                <div class="form-group mb-3">
                    <label for="sampleRemark" class="form-label">备注信息（选填）</label>
                    <textarea id="sampleRemark" class="form-input h-20" placeholder="如有特殊要求，请在此说明"></textarea>
                </div>
                
                <!-- 取消和提交按钮在同一行 -->
                <div class="address-form-actions">
                    <button id="cancelAddressForm" class="cancel-btn"><i class="fas fa-times mr-1"></i> 取消</button>
                    <button id="submitSampleApplication" class="submit-sample-btn-inline"><i class="fas fa-paper-plane mr-1"></i> 提交申请</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 样品申请模态窗口遮罩层 -->
    <div id="sampleFormOverlay" class="sample-form-overlay"></div>
    
    <!-- 样品申请成功提示 -->
    <div class="toast-notification" id="sampleToast">
        <div class="toast-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="toast-message">皮样申请已提交，我们会尽快为您寄送！</div>
    </div>

    <script>
    // 沙发定制页面主要脚本
    document.addEventListener('DOMContentLoaded', function() {
        // 读取已选择的场景（如果有）
        try {
            const selectedScenes = JSON.parse(localStorage.getItem('selectedSofaScenes') || '[]');
            if(selectedScenes.length > 0) {
                // 如果有选择的场景，在推荐区域显示
                const recommendationText = document.getElementById('spaceRecommendation');
                if(recommendationText) {
                    const originalText = recommendationText.textContent;
                    recommendationText.innerHTML = `
                        <div class="mb-2"><strong>已选择场景:</strong> ${selectedScenes.join('、')}</div>
                        ${originalText}
                    `;
                }
            }
        } catch(e) {
            console.error('读取场景数据失败', e);
        }
        
        // 初始化价格信息
        let basePrice = 3999;
        let tablePrice = 0;
        let functionPrice = 0;
        let positionPrice = 0;
        
        // 声明价格显示元素变量
        let basePriceEl, tablePriceEl, functionPriceEl, positionPriceEl, totalPriceEl;
        
        // 获取所有沙发类型卡片
        const sofaTypeCards = document.querySelectorAll('.sofa-type-card');
        
        // 获取所有茶几选项
        const tableOptions = document.querySelectorAll('.accessory-section:nth-child(2) .accessory-option');
        
        // 获取所有功能位选项
        const functionOptions = document.querySelectorAll('.accessory-section:nth-child(3) .accessory-option');
        
        // 获取功能位位置选择区域
        const functionPositionSection = document.getElementById('function-position-section');
        
        // 获取双人位、三人位、四人位功能位置选项组
        const doubleSeatOptions = document.querySelector('.double-seat-options');
        const tripleSeatOptions = document.querySelector('.triple-seat-options');
        const quadSeatOptions = document.querySelector('.quad-seat-options');
        
        // 当前沙发类型变量
        let currentSofaType = 'double'; // 默认双人位
        
        // 初始化价格元素
        function initializePriceElements() {
            basePriceEl = document.getElementById('sofa-base-price');
            tablePriceEl = document.getElementById('table-price');
            functionPriceEl = document.getElementById('function-price');
            positionPriceEl = document.getElementById('position-price');
            totalPriceEl = document.getElementById('total-price');
        }
        
        // 初始化价格元素
        initializePriceElements();
        
        // 在步骤4中添加价格摘要
        const priceDetailsHtml = `
        <div class="price-summary" style="margin-top: 20px;">
            <div class="price-summary-content">
                <div class="price-detail">
                    <div class="price-detail-item">
                        <div class="price-detail-label">基础价格</div>
                        <div class="price-detail-value" id="sofa-base-price">¥${basePrice}</div>
                    </div>
                    <div class="price-detail-item">
                        <div class="price-detail-label">茶几选项</div>
                        <div class="price-detail-value" id="table-price">¥0</div>
                    </div>
                    <div class="price-detail-item">
                        <div class="price-detail-label">功能位选择</div>
                        <div class="price-detail-value" id="function-price">¥0</div>
                    </div>
                    <div class="price-detail-item">
                        <div class="price-detail-label">功能位位置</div>
                        <div class="price-detail-value" id="position-price">¥0</div>
                    </div>
                </div>
                <div class="price-total">
                    <div class="price-total-label">总价</div>
                    <div class="price-total-value" id="total-price">¥${basePrice}</div>
                </div>
            </div>
        </div>`;
        
        // 添加价格摘要到功能位置选择区域后面
        const addPriceSummary = () => {
            // 价格摘要容器
            const priceSummaryContainer = document.createElement('div');
            priceSummaryContainer.innerHTML = priceDetailsHtml;
            
            // 检查是否已存在价格摘要
            const existingSummary = document.querySelector('.price-summary');
            if (existingSummary) {
                existingSummary.parentNode.removeChild(existingSummary);
            }
            
            // 在功能位位置选择区域后面添加价格摘要
            const functionPositionSection = document.getElementById('function-position-section');
            if (functionPositionSection && functionPositionSection.parentNode) {
                functionPositionSection.parentNode.insertBefore(priceSummaryContainer.firstElementChild, functionPositionSection.nextSibling);
                // 重新初始化价格元素，因为DOM已经变化
                initializePriceElements();
            }
        };
        
        // 在页面加载完成后添加价格摘要
        setTimeout(addPriceSummary, 100);

        // 更新沙发尺寸显示的函数
        function updateSofaDisplay(card) {
            // 获取当前选中沙发的名称和尺寸
            const sofaName = card.getAttribute('data-name');
            const sofaType = card.getAttribute('data-type');
            
            // 更新当前沙发类型
            currentSofaType = sofaType;
            
            // 更新预览区标题 - 调整为新的布局结构
            const nameElement = document.querySelector('.current-size-display .sofa-name');
            if (nameElement) {
                nameElement.textContent = sofaName;
            } else {
                // 兼容旧布局，以防HTML结构未完全更新
                const oldElement = document.querySelector('.current-size-display .font-medium');
                if (oldElement) {
                    oldElement.textContent = sofaName;
                }
            }
            
            // 根据不同沙发类型更新尺寸
            let width, depth, height;
            
            // 直接从沙发卡片中获取宽度信息
            const cardSizeText = card.querySelector('.sofa-card-size').textContent;
            const widthMatch = cardSizeText.match(/\d+/);
            if (widthMatch) {
                width = parseInt(widthMatch[0]);
            }
            
            switch(sofaType) {
                case 'single':
                    width = width || 90;
                    depth = 90;
                    height = 45;
                    break;
                case 'double':
                    width = width || 180;
                    depth = 90;
                    height = 45;
                    break;
                case 'triple':
                    width = width || 210; // 三人位沙发宽度
                    depth = 90;
                    height = 45;
                    break;
                case 'quad':
                    width = width || 240;
                    depth = 90;
                    height = 45;
                    break;
                case 'triple-left':
                case 'triple-right':
                    width = width || 270;
                    depth = 90;
                    height = 45;
                    break;
                default:
                    width = width || 180;
                    depth = 90;
                    height = 45;
            }
            
            // 更新尺寸显示
            const vizLengthEls = document.querySelectorAll('#vizLength');
            const vizDepthEls = document.querySelectorAll('#vizDepth');
            const vizHeightEls = document.querySelectorAll('#vizHeight');
            
            vizLengthEls.forEach(el => el.textContent = width);
            vizDepthEls.forEach(el => el.textContent = depth);
            vizHeightEls.forEach(el => el.textContent = height);
            
            // 更新顶部尺寸概览
            const sizeDisplayEls = document.querySelectorAll('#size-dimensions, #preview-dimensions');
            sizeDisplayEls.forEach(el => {
                if (el) el.textContent = `（${width} × ${depth} × ${height} cm）`;
            });
            
            // 更新沙发图片
            const sofaImages = document.querySelectorAll('#sofaTypeImage');
            sofaImages.forEach(img => {
                if (img) {
                    if (sofaType === 'triple-left' || sofaType === 'triple-right') {
                        img.src = `../img/sofa-types/${sofaType}.svg`;
                    } else {
                        img.src = `../img/sofa-types/${sofaType}-seats.svg`;
                    }
                }
            });
            
            // 更新功能位位置预览图片
            const functionPositionPreview = document.getElementById('functionPositionPreview');
            if (functionPositionPreview) {
                if (sofaType === 'triple-left' || sofaType === 'triple-right') {
                    functionPositionPreview.src = `../img/sofa-types/${sofaType}.svg`;
                } else {
                    functionPositionPreview.src = `../img/sofa-types/${sofaType}-seats.svg`;
                }
            }
            
            // 同步更新空间推荐文字
            updateSpaceRecommendation(sofaName, width);
            
            // 调整尺寸标记的位置
            adjustDimensionMarkers(width, depth, height, sofaType);
            
            // 更新基础价格 - 根据沙发尺寸或类型设置不同价格
            let newBasePrice = 2999;
            if (sofaType === 'single') {
                newBasePrice = 1999;
            } else if (sofaType === 'double') {
                newBasePrice = 2999;
            } else if (sofaType === 'triple') {
                newBasePrice = 3999;
            } else if (sofaType === 'quad') {
                newBasePrice = 4999;
            } else if (sofaType === 'triple-left' || sofaType === 'triple-right') {
                newBasePrice = 5999;
            }
            
            // 更新价格显示
            updatePriceDisplay(newBasePrice);
            
            // 更新订单摘要中的沙发信息
            updateSofaSummary(sofaName, width);
            
            // 检查并更新功能位置选择显示
            updateFunctionPositionVisibility();
        }
        
        // 更新功能位位置选择区域显示/隐藏的函数
        function updateFunctionPositionVisibility() {
            // 获取当前选中的功能位选项
            const selectedFunction = document.querySelector('.accessory-section:nth-child(3) .accessory-option.active');
            
            // 检查是否是妃位沙发（不能安装功能位）
            const isFeiSofa = currentSofaType === 'triple-left' || currentSofaType === 'triple-right';
            
            // 检查沙发类型是否是单人位（不需要选择位置）
            const isSingleSeat = currentSofaType === 'single';
            
            // 显示功能位位置选项的条件：
            // 1. 选择了功能位（非"无"选项）
            // 2. 不是单人位沙发
            // 3. 不是妃位沙发
            const showPosition = selectedFunction && 
                               selectedFunction.getAttribute('data-show-position') === 'true' && 
                               !isSingleSeat && 
                               !isFeiSofa;
            
            // 如果是妃位沙发且选择了功能位，显示提示信息
            const functionWarning = document.getElementById('function-warning');
            if (functionWarning) {
                if (isFeiSofa && selectedFunction && selectedFunction.getAttribute('data-show-position') === 'true') {
                    functionWarning.style.display = 'block';
                    functionWarning.textContent = '注意：妃位沙发不支持安装功能位';
                } else {
                    functionWarning.style.display = 'none';
                }
            }
            
            // 更新功能位位置选择区域的显示/隐藏
            if (functionPositionSection) {
                functionPositionSection.style.display = showPosition ? 'block' : 'none';
            }
            
            // 根据沙发类型显示相应的位置选项
            if (showPosition) {
                // 隐藏所有位置选项组
                if (doubleSeatOptions) doubleSeatOptions.style.display = 'none';
                if (tripleSeatOptions) tripleSeatOptions.style.display = 'none';
                if (quadSeatOptions) quadSeatOptions.style.display = 'none';
                
                // 根据沙发类型显示对应的位置选项组
                if (currentSofaType === 'double') {
                    if (doubleSeatOptions) doubleSeatOptions.style.display = 'grid';
                } else if (currentSofaType === 'triple') {
                    if (tripleSeatOptions) tripleSeatOptions.style.display = 'grid';
                } else if (currentSofaType === 'quad') {
                    if (quadSeatOptions) quadSeatOptions.style.display = 'grid';
                }
                
                // 重置位置选择
                resetPositionSelection();
            }
        }
        
        // 重置位置选择为默认值"无"
        function resetPositionSelection() {
            const allPositionOptions = document.querySelectorAll('.position-option');
            allPositionOptions.forEach(option => option.classList.remove('active'));
            
            // 选中当前显示的位置选项组中的"无"选项
            let visibleOptionsGroup;
            if (currentSofaType === 'double' && doubleSeatOptions) {
                visibleOptionsGroup = doubleSeatOptions;
            } else if ((currentSofaType === 'triple' || currentSofaType === 'triple-left' || currentSofaType === 'triple-right') && tripleSeatOptions) {
                visibleOptionsGroup = tripleSeatOptions;
            } else if (currentSofaType === 'quad' && quadSeatOptions) {
                visibleOptionsGroup = quadSeatOptions;
            }
            
            if (visibleOptionsGroup) {
                const noneOption = visibleOptionsGroup.querySelector('.position-option[data-position="none"]');
                if (noneOption) noneOption.classList.add('active');
            }
            
            // 更新当前位置显示
            const currentFunctionPosition = document.getElementById('currentFunctionPosition');
            if (currentFunctionPosition) {
                currentFunctionPosition.textContent = '尚未选择位置';
            }
            
            // 隐藏所有标记
            const functionMarkers = document.querySelectorAll('.function-marker');
            functionMarkers.forEach(marker => marker.style.display = 'none');
        }
        
        // 调整尺寸标记的位置函数
        function adjustDimensionMarkers(width, depth, height, sofaType) {
            const widthMarkers = document.querySelectorAll('.width-marker');
            const depthMarkers = document.querySelectorAll('.depth-marker');
            
            // 根据沙发宽度调整长度标记的位置
            widthMarkers.forEach(widthMarker => {
                if (width >= 240) { // 四人位或更大
                    widthMarker.style.top = '65%';
                    widthMarker.style.width = '100%';
                    
                    // 文字位置向上移动避免重叠
                    const widthLabel = widthMarker.querySelector('.marker-label');
                    if (widthLabel) widthLabel.style.top = '-25px';
                } else if (width >= 210) { // 三人位
                    widthMarker.style.top = '65%';
                    widthMarker.style.width = '95%';
                    
                    const widthLabel = widthMarker.querySelector('.marker-label');
                    if (widthLabel) widthLabel.style.top = '-5px';
                } else { // 二人位或更小
                    widthMarker.style.top = '65%';
                    widthMarker.style.width = '90%';
                    
                    const widthLabel = widthMarker.querySelector('.marker-label');
                    if (widthLabel) widthLabel.style.top = '0';
                }
            });
            
            // 3+妃类型的特殊处理
            depthMarkers.forEach(depthMarker => {
                if (sofaType === 'triple-left' || sofaType === 'triple-right') {
                    depthMarker.style.right = '15%';
                    depthMarker.style.width = '25%';
                } else {
                    depthMarker.style.right = '5%';
                    depthMarker.style.width = '30%';
                }
            });
        }
        
        // 更新空间推荐文字
        function updateSpaceRecommendation(sofaName, width) {
            const recommendationEl = document.getElementById('spaceRecommendation');
            if (recommendationEl) {
                switch(sofaName) {
                    case '单人位':
                        recommendationEl.textContent = `单人位沙发适合小户型或书房，建议搭配一个小茶几，保持通道宽度至少60cm。`;
                        break;
                    case '二人位':
                        recommendationEl.textContent = `二人位沙发适合15-20㎡的客厅空间，建议搭配一个茶几和一个小边几，保持通道宽度至少70cm。`;
                        break;
                    case '三人位':
                        recommendationEl.textContent = `三人位沙发适合20-25㎡的客厅空间，宽度${width}cm，建议与墙面保持至少30cm的距离，搭配一个长方形茶几。`;
                        break;
                    case '四人位':
                        recommendationEl.textContent = `四人位沙发适合25㎡以上的客厅空间，宽度${width}cm，建议搭配一个大茶几和两个边几，营造舒适的会客区。`;
                        break;
                    case '3+左妃':
                    case '3+右妃':
                        recommendationEl.textContent = `${sofaName}沙发适合L型空间，宽度${width}cm，建议放置在客厅拐角处，搭配一个圆形或方形茶几。`;
                        break;
                    default:
                        recommendationEl.textContent = `该款沙发宽度${width}cm，建议根据您的空间大小选择合适的摆放位置。`;
                }
            }
        }
        
        // 更新订单摘要中的沙发信息
        function updateSofaSummary(sofaName, width) {
            // 查找订单摘要中的尺寸元素
            const sizeElement = document.querySelector('.step-content[data-step="5"] .flex.justify-between:nth-child(3) span:nth-child(2)');
            if (sizeElement) {
                sizeElement.textContent = `${width}cm`;
            }
        }
        
        // 更新价格显示函数
        function updatePriceDisplay(base = null) {
            if (base !== null) {
                basePrice = base;
            }
            
            if (basePriceEl) {
                basePriceEl.textContent = `¥${basePrice}`;
            }
            
            if (tablePriceEl) {
                tablePriceEl.textContent = `¥${tablePrice}`;
            }
            
            if (functionPriceEl) {
                functionPriceEl.textContent = `¥${functionPrice}`;
            }
            
            if (positionPriceEl) {
                positionPriceEl.textContent = `¥${positionPrice}`;
            }
            
            if (totalPriceEl) {
                const totalPrice = basePrice + tablePrice + functionPrice + positionPrice;
                totalPriceEl.textContent = `¥${totalPrice}`;
                
                // 更新订单摘要的总价
                const orderTotalElement = document.querySelector('.step-content[data-step="5"] .flex.justify-between.font-medium.text-lg.mt-4 span:nth-child(2)');
                if (orderTotalElement) {
                    orderTotalElement.textContent = `¥${totalPrice}`;
                }
            }
        }
        
        // 更新订单摘要中的配件信息
        function updateOrderSummary() {
            // 找到订单摘要中的配件元素
            const summaryAccessories = document.querySelector('.step-content[data-step="5"] .flex.justify-between:nth-child(5) span:nth-child(2)');
            
            if (summaryAccessories) {
                // 获取当前选中的茶几和功能位
                const selectedTable = document.querySelector('.accessory-section:nth-child(2) .accessory-option.active');
                const selectedFunction = document.querySelector('.accessory-section:nth-child(3) .accessory-option.active');
                
                let accessoryText = '';
                
                // 添加茶几信息
                if (selectedTable) {
                    const tableName = selectedTable.getAttribute('data-name');
                    if (tableName !== '无') {
                        accessoryText += tableName + '茶几';
                    }
                }
                
                // 添加功能位信息
                if (selectedFunction) {
                    const functionName = selectedFunction.getAttribute('data-name');
                    if (functionName !== '无') {
                        if (accessoryText) {
                            accessoryText += '，';
                        }
                        accessoryText += functionName;
                    }
                }
                
                // 如果没有选择任何配件
                if (!accessoryText) {
                    accessoryText = '无';
                }
                
                // 更新订单摘要
                summaryAccessories.textContent = accessoryText;
            }
        }
        
        // 为茶几选项添加点击事件
        if (tableOptions && tableOptions.length > 0) {
            tableOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // 移除其他选项的active类
                    tableOptions.forEach(opt => opt.classList.remove('active'));
                    
                    // 给当前选项添加active类
                    this.classList.add('active');
                    
                    // 更新价格
                    tablePrice = parseInt(this.getAttribute('data-price')) || 0;
                    updatePriceDisplay();
                    
                    // 更新订单摘要中的配件信息
                    updateOrderSummary();
                });
            });
        }
        
        // 为功能位选项添加点击事件
        if (functionOptions && functionOptions.length > 0) {
            functionOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // 检查是否是妃位沙发（不能安装功能位）
                    const isFeiSofa = currentSofaType === 'triple-left' || currentSofaType === 'triple-right';
                    
                    // 如果是选择非"无"选项，且当前是妃位沙发，则提示并返回
                    if (isFeiSofa && this.getAttribute('data-show-position') === 'true') {
                        // 显示警告提示
                        const functionWarning = document.getElementById('function-warning');
                        if (functionWarning) {
                            functionWarning.style.display = 'block';
                            functionWarning.textContent = '注意：妃位沙发不支持安装功能位';
                        }
                        return; // 不执行后续点击操作
                    }
                    
                    // 移除其他选项的active类
                    functionOptions.forEach(opt => opt.classList.remove('active'));
                    
                    // 给当前选项添加active类
                    this.classList.add('active');
                    
                    // 更新价格
                    functionPrice = parseInt(this.getAttribute('data-price')) || 0;
                    updatePriceDisplay();
                    
                    // 更新订单摘要中的配件信息
                    updateOrderSummary();
                    
                    // 更新功能位位置选择区域的显示/隐藏
                    updateFunctionPositionVisibility();
                });
            });
        }
        
        // 为位置选项添加点击事件
        const positionOptions = document.querySelectorAll('.position-option');
        if (positionOptions && positionOptions.length > 0) {
            positionOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // 获取当前显示的位置选项组
                    let visibleOptionsGroup;
                    if (currentSofaType === 'double' && doubleSeatOptions && doubleSeatOptions.style.display !== 'none') {
                        visibleOptionsGroup = doubleSeatOptions;
                    } else if (currentSofaType === 'triple' && tripleSeatOptions && tripleSeatOptions.style.display !== 'none') {
                        visibleOptionsGroup = tripleSeatOptions;
                    } else if (currentSofaType === 'quad' && quadSeatOptions && quadSeatOptions.style.display !== 'none') {
                        visibleOptionsGroup = quadSeatOptions;
                    }
                    
                    if (!visibleOptionsGroup) return;
                    
                    // 获取位置和价格
                    const position = this.getAttribute('data-position');
                    
                    // 特殊处理"无"选项
                    if (position === 'none') {
                        // 如果点击"无"选项，取消其他所有选择
                        const groupOptions = visibleOptionsGroup.querySelectorAll('.position-option');
                        groupOptions.forEach(opt => opt.classList.remove('active'));
                        this.classList.add('active');
                        
                        // 隐藏所有功能位标记
                        updateFunctionMarkers([]);
                        
                        // 更新当前位置显示
                        const currentFunctionPosition = document.getElementById('currentFunctionPosition');
                        if (currentFunctionPosition) {
                            currentFunctionPosition.textContent = '无功能位';
                        }
                    } else {
                        // 如果点击的不是"无"选项，取消"无"选项的选中状态
                        const noneOption = visibleOptionsGroup.querySelector('.position-option[data-position="none"]');
                        if (noneOption) {
                            noneOption.classList.remove('active');
                        }
                        
                        // 切换当前选项的选中状态
                        this.classList.toggle('active');
                        
                        // 获取所有选中的位置选项
                        const selectedPositions = [];
                        visibleOptionsGroup.querySelectorAll('.position-option.active').forEach(active => {
                            const pos = active.getAttribute('data-position');
                            if (pos !== 'none') {
                                selectedPositions.push(pos);
                            }
                        });
                        
                        // 如果没有选中任何位置，默认选中"无"选项
                        if (selectedPositions.length === 0 && noneOption) {
                            noneOption.classList.add('active');
                            updateFunctionMarkers([]);
                            
                            // 更新当前位置显示
                            const currentFunctionPosition = document.getElementById('currentFunctionPosition');
                            if (currentFunctionPosition) {
                                currentFunctionPosition.textContent = '无功能位';
                            }
                        } else {
                            // 更新功能位标记显示
                            updateFunctionMarkers(selectedPositions);
                            
                            // 更新当前位置显示
                            const currentFunctionPosition = document.getElementById('currentFunctionPosition');
                            if (currentFunctionPosition) {
                                // 获取所有选中位置的名称
                                const positionNames = [];
                                visibleOptionsGroup.querySelectorAll('.position-option.active').forEach(active => {
                                    const name = active.querySelector('.position-name')?.textContent;
                                    if (name) positionNames.push(name);
                                });
                                
                                currentFunctionPosition.textContent = positionNames.join('、');
                            }
                        }
                    }
                    
                    // 计算功能位位置的总价格
                    calculatePositionPrice();
                });
            });
        }
        
        // 计算功能位位置的总价格
        function calculatePositionPrice() {
            // 获取当前显示的位置选项组
            let visibleOptionsGroup;
            if (currentSofaType === 'double' && doubleSeatOptions && doubleSeatOptions.style.display !== 'none') {
                visibleOptionsGroup = doubleSeatOptions;
            } else if (currentSofaType === 'triple' && tripleSeatOptions && tripleSeatOptions.style.display !== 'none') {
                visibleOptionsGroup = tripleSeatOptions;
            } else if (currentSofaType === 'quad' && quadSeatOptions && quadSeatOptions.style.display !== 'none') {
                visibleOptionsGroup = quadSeatOptions;
            }
            
            if (!visibleOptionsGroup) return;
            
            // 获取所有选中的位置及其价格
            let totalPositionPrice = 0;
            visibleOptionsGroup.querySelectorAll('.position-option.active').forEach(active => {
                const price = parseInt(active.getAttribute('data-price')) || 0;
                totalPositionPrice += price;
            });
            
            // 更新全局位置价格变量
            positionPrice = totalPositionPrice;
            
            // 更新功能位位置价格
            if (positionPriceEl) {
                positionPriceEl.textContent = `¥${positionPrice}`;
            }
            
            // 更新总价
            updatePriceDisplay();
        }
        
        // 更新总价格
        function updateTotalPrice() {
            // 获取基础价格
            const basePrice = parseInt(basePriceEl?.textContent?.replace('¥', '')) || 0;
            
            // 获取茶几价格
            const tablePrice = parseInt(tablePriceEl?.textContent?.replace('¥', '')) || 0;
            
            // 获取功能位价格
            const functionPrice = parseInt(functionPriceEl?.textContent?.replace('¥', '')) || 0;
            
            // 获取位置价格
            const positionPriceEl = document.getElementById('position-price');
            const positionPrice = positionPriceEl ? (parseInt(positionPriceEl.textContent?.replace('¥', '')) || 0) : 0;
            
            // 计算总价
            const totalPrice = basePrice + tablePrice + functionPrice + positionPrice;
            
            // 更新总价显示
            if (totalPriceEl) {
                totalPriceEl.textContent = `¥${totalPrice}`;
            }
            
            // 更新订单摘要的总价
            const orderTotalElement = document.querySelector('.step-content[data-step="5"] .flex.justify-between.font-medium.text-lg.mt-4 span:nth-child(2)');
            if (orderTotalElement) {
                orderTotalElement.textContent = `¥${totalPrice}`;
            }
        }
        
        // 更新功能位标记显示的函数
        function updateFunctionMarkers(selectedPositions) {
            // 获取所有功能位标记
            const leftMarker = document.getElementById('leftFunctionMarker');
            const rightMarker = document.getElementById('rightFunctionMarker');
            const middleMarker = document.getElementById('middleFunctionMarker');
            const middleLeftMarker = document.getElementById('middleLeftFunctionMarker');
            const middleRightMarker = document.getElementById('middleRightFunctionMarker');
            
            // 隐藏所有标记
            if (leftMarker) leftMarker.style.display = 'none';
            if (rightMarker) rightMarker.style.display = 'none';
            if (middleMarker) middleMarker.style.display = 'none';
            if (middleLeftMarker) middleLeftMarker.style.display = 'none';
            if (middleRightMarker) middleRightMarker.style.display = 'none';
            
            // 如果没有选择任何位置，直接返回
            if (!selectedPositions || selectedPositions.length === 0) return;
            
            // 根据选择的位置显示对应的标记
            selectedPositions.forEach(position => {
                switch (position) {
                    case 'left':
                        if (leftMarker) leftMarker.style.display = 'flex';
                        break;
                    case 'right':
                        if (rightMarker) rightMarker.style.display = 'flex';
                        break;
                    case 'middle':
                        if (middleMarker) middleMarker.style.display = 'flex';
                        break;
                    case 'middle-left':
                        if (middleLeftMarker) middleLeftMarker.style.display = 'flex';
                        break;
                    case 'middle-right':
                        if (middleRightMarker) middleRightMarker.style.display = 'flex';
                        break;
                    case 'edges':
                        if (leftMarker) leftMarker.style.display = 'flex';
                        if (rightMarker) rightMarker.style.display = 'flex';
                        break;
                    case 'all':
                        if (leftMarker) leftMarker.style.display = 'flex';
                        if (rightMarker) rightMarker.style.display = 'flex';
                        if (middleLeftMarker) middleLeftMarker.style.display = 'flex';
                        if (middleRightMarker) middleRightMarker.style.display = 'flex';
                        break;
                }
            });
        }
        
        // 为每个沙发卡片添加点击事件
        sofaTypeCards.forEach(card => {
            card.addEventListener('click', function() {
                // 移除其他卡片的active类
                sofaTypeCards.forEach(c => c.classList.remove('active'));
                
                // 添加当前卡片的active类
                this.classList.add('active');
                
                // 更新显示
                updateSofaDisplay(this);
            });
        });
        
        // 初始化：页面加载时根据当前选中的沙发更新显示
        const activeCard = document.querySelector('.sofa-type-card.active');
        if (activeCard) {
            updateSofaDisplay(activeCard);
        } else {
            // 如果没有选中任何卡片，默认选中二人位
            const doubleCard = document.querySelector('.sofa-type-card[data-type="double"]');
            if (doubleCard) {
                doubleCard.classList.add('active');
                updateSofaDisplay(doubleCard);
            }
        }
        
        // 初始化价格显示和订单摘要
        updatePriceDisplay();
        updateOrderSummary();
    });
    
    // 修复沙发类型切换和尺寸标记位置问题的其他脚本
    
    // 步骤5：确认配置页数据更新函数
    document.addEventListener('DOMContentLoaded', function() {
        // 当用户进入确认配置页面时更新数据
        const stepsIndicator = document.querySelector('.steps-indicator');
        const step5 = stepsIndicator.querySelector('[data-step="5"]');
        
        if (step5) {
            step5.addEventListener('click', updateConfirmationPage);
        }
        
        // 当用户点击"下一步"按钮并到达确认配置页面时也更新数据
        const nextButton = document.getElementById('nextStep');
        if (nextButton) {
            nextButton.addEventListener('click', function() {
                const activeStep = document.querySelector('.step-content.active');
                if (activeStep && activeStep.getAttribute('data-step') === '4') {
                    // 如果当前是第4步，下一步就是确认配置页
                    setTimeout(updateConfirmationPage, 100); // 给页面一点时间切换
                }
            });
        }
        
        // 更新确认配置页面的所有信息
        function updateConfirmationPage() {
            // 获取已选择的沙发信息
            const activeCard = document.querySelector('.sofa-type-card.active');
            if (!activeCard) return;
            
            const sofaType = activeCard.getAttribute('data-type');
            const sofaName = activeCard.getAttribute('data-name');
            
            // 获取尺寸信息
            const lengthValue = document.getElementById('length-value')?.textContent || '180';
            const depthValue = document.getElementById('depth-value')?.textContent || '90';
            const heightValue = document.getElementById('height-value')?.textContent || '45';
            
            // 获取面料信息
            const fabricCard = document.querySelector('.fabric-card');
            const fabricModel = fabricCard ? fabricCard.querySelector('.fabric-model')?.textContent || '默认面料' : '默认面料';
            const fabricColor = '#b0b0b0'; // 这里应该从选择的面料中获取颜色
            
            // 获取配件信息
            const selectedTable = document.querySelector('.accessory-section:nth-child(2) .accessory-option.active');
            const selectedFunction = document.querySelector('.accessory-section:nth-child(3) .accessory-option.active');
            
            const tableName = selectedTable ? selectedTable.getAttribute('data-name') : '无';
            const tablePrice = selectedTable ? parseInt(selectedTable.getAttribute('data-price')) || 0 : 0;
            
            const functionName = selectedFunction ? selectedFunction.getAttribute('data-name') : '无';
            const functionPrice = selectedFunction ? parseInt(selectedFunction.getAttribute('data-price')) || 0 : 0;
            
            // 获取基础价格（基于沙发类型）
            let basePrice = 2999;
            if (sofaType === 'single') {
                basePrice = 1999;
            } else if (sofaType === 'double') {
                basePrice = 2999;
            } else if (sofaType === 'triple') {
                basePrice = 3999;
            } else if (sofaType === 'quad') {
                basePrice = 4999;
            } else if (sofaType === 'triple-left' || sofaType === 'triple-right') {
                basePrice = 5999;
            }
            
            // 计算总价
            const fabricPrice = 0; // 如果面料有额外价格，应该添加
            const totalPrice = basePrice + fabricPrice + tablePrice + functionPrice;
            
            // 更新沙发预览信息
            document.getElementById('confirm-sofa-name').textContent = `${sofaName}沙发`;
            document.getElementById('confirm-sofa-type').textContent = sofaName;
            
            // 更新沙发图片
            const confirmSofaImage = document.getElementById('confirm-sofa-image');
            if (confirmSofaImage) {
                if (sofaType === 'triple-left' || sofaType === 'triple-right') {
                    confirmSofaImage.src = `../img/sofa-types/${sofaType}.svg`;
                } else {
                    confirmSofaImage.src = `../img/sofa-types/${sofaType}-seats.svg`;
                }
            }
            
            // 更新尺寸信息
            document.getElementById('confirm-sofa-length').textContent = lengthValue;
            document.getElementById('confirm-sofa-depth').textContent = depthValue;
            document.getElementById('confirm-sofa-height').textContent = heightValue;
            
            // 更新配置详情
            document.getElementById('confirm-model-name').textContent = "现代简约沙发"; // 这里应该是真实选择的型号
            document.getElementById('confirm-sofa-type-text').textContent = `${sofaName}沙发`;
            document.getElementById('confirm-dimensions').textContent = `${lengthValue} × ${depthValue} × ${heightValue} cm`;
            document.getElementById('confirm-fabric-name').textContent = fabricModel;
            
            // 更新面料颜色样块
            const fabricColorEl = document.getElementById('confirm-fabric-color');
            if (fabricColorEl) {
                fabricColorEl.style.backgroundColor = fabricColor;
            }
            
            // 更新配件信息
            document.getElementById('confirm-table').textContent = tableName !== '无' ? `${tableName}茶几` : '无';
            document.getElementById('confirm-function').textContent = functionName;
            
            // 更新价格信息
            document.getElementById('confirm-base-price').textContent = `¥${basePrice.toLocaleString()}`;
            document.getElementById('confirm-fabric-price').textContent = `¥${fabricPrice.toLocaleString()}`;
            document.getElementById('confirm-table-price').textContent = `¥${tablePrice.toLocaleString()}`;
            document.getElementById('confirm-function-price').textContent = `¥${functionPrice.toLocaleString()}`;
            document.getElementById('confirm-total-price').textContent = `¥${totalPrice.toLocaleString()}`;
            document.getElementById('bottom-total-price').textContent = `¥${totalPrice.toLocaleString()}`;
            
            // 根据是否选择茶几和功能来显示或隐藏对应的价格项
            const tablePriceItem = document.getElementById('table-price-item');
            if (tablePriceItem) {
                tablePriceItem.style.display = tablePrice > 0 ? 'flex' : 'none';
            }
            
            const functionPriceItem = document.getElementById('function-price-item');
            if (functionPriceItem) {
                functionPriceItem.style.display = functionPrice > 0 ? 'flex' : 'none';
            }
        }
    });

    // 添加脚本在第5步时显示提交按钮并隐藏下一步按钮
    document.addEventListener('DOMContentLoaded', function() {
        const stepsIndicator = document.querySelector('.steps-indicator');
        const steps = stepsIndicator.querySelectorAll('.step');
        const nextButton = document.getElementById('nextStep');
        const submitButton = document.getElementById('submitOrder');
        
        // 修复：确保按钮元素存在
        if (!nextButton || !submitButton) {
            console.error('导航按钮未找到');
            return;
        }
        
        // 当步骤切换时检查是否是第5步
        function checkAndUpdateButtons() {
            console.log('检查当前步骤...');
            // 查找当前激活的步骤内容
            const activeContent = document.querySelector('.step-content.active');
            if (activeContent) {
                const step = parseInt(activeContent.getAttribute('data-step'));
                console.log('当前步骤:', step);
                
                if (step === 5) {
                    // 如果是第5步，显示提交按钮，隐藏下一步按钮
                    nextButton.style.display = 'none';
                    submitButton.style.display = 'block';
                    console.log('步骤5: 显示提交按钮');
                } else {
                    // 否则显示下一步按钮，隐藏提交按钮
                    nextButton.style.display = 'block';
                    submitButton.style.display = 'none';
                    console.log('其他步骤: 显示下一步按钮');
                }
            }
        }
        
        // 立即检查当前步骤
        checkAndUpdateButtons();
        
        // 为步骤指示器添加点击事件
        steps.forEach(step => {
            step.addEventListener('click', function() {
                setTimeout(checkAndUpdateButtons, 100);
            });
        });
        
        // 为下一步按钮添加点击事件
        nextButton.addEventListener('click', function() {
            setTimeout(checkAndUpdateButtons, 100);
        });
        
        // 为上一步按钮添加点击事件
        document.getElementById('prevStep').addEventListener('click', function() {
            setTimeout(checkAndUpdateButtons, 100);
        });
        
        // 提交按钮点击事件
        submitButton.addEventListener('click', function() {
            // 这里可以添加提交订单的逻辑
            alert('订单已提交，客服将尽快与您联系！');
        });
        
        // 增加一个额外的检查，确保在步骤5时一定会显示提交按钮
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.attributeName === 'class') {
                    // 如果有类名变化，检查是否是步骤内容的激活状态改变
                    if (mutation.target.classList.contains('active') && 
                        mutation.target.getAttribute('data-step') === '5') {
                        // 强制显示提交按钮
                        nextButton.style.display = 'none';
                        submitButton.style.display = 'block';
                        console.log('MutationObserver: 步骤5被激活，显示提交按钮');
                    }
                }
            });
        });
        
        // 观察所有步骤内容元素
        document.querySelectorAll('.step-content').forEach(content => {
            observer.observe(content, { attributes: true });
        });
    });
    </script>

    <script src="../js/sofa-custom.js"></script>
    <script src="../js/sofa-fix.js"></script>
    <script src="../js/sofa-models.js"></script>
    <script src="../js/sofa-submit-fix.js"></script>
</body>
</html> 